<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Super Mario â€“ Lá»‹ch Sá»­ Äáº£ng CSVN</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Be+Vietnam+Pro:ital,wght@0,400;0,600;0,700;1,400&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
:root{--red:#B22222;--rd:#7a1111;--rl:#d43030;--gold:#FFD700;--gd:#cc9900;--gl:#ffe566;--bg:#0d0500}
html,body{width:100%;height:100%;background:#000;overflow:hidden}
body{display:flex;flex-direction:column;font-family:'Be Vietnam Pro',sans-serif}

/* HUD */
#hud{width:100%;background:linear-gradient(180deg,#8a0000,var(--red) 60%,#900);border-bottom:3px solid var(--gold);padding:7px 16px;display:flex;align-items:center;justify-content:space-between;box-shadow:0 3px 12px rgba(0,0,0,.5);flex-wrap:wrap;gap:4px;flex-shrink:0}
.hud-left{display:flex;align-items:center;gap:10px}
.hud-star{font-size:16px;animation:spin 4s linear infinite}
@keyframes spin{0%{transform:rotateY(0)}50%{transform:rotateY(180deg)}100%{transform:rotateY(360deg)}}
.hud-title{font-family:'Press Start 2P',monospace;color:var(--gold);font-size:7px;text-shadow:1px 1px 0 #000,0 0 8px #ffaa00}
.hud-right{display:flex;align-items:center;gap:12px}
.progress-wrap{display:flex;align-items:center;gap:6px}
.progress-bar-bg{width:140px;height:12px;background:var(--rd);border:2px solid var(--gold);border-radius:2px;overflow:hidden;position:relative}
.progress-bar-fill{height:100%;background:linear-gradient(90deg,#ffaa00,var(--gold),#ffee88);transition:width .5s;box-shadow:0 0 8px var(--gold)}
.progress-bar-bg::after{content:'';position:absolute;inset:0;background:repeating-linear-gradient(90deg,transparent 0,transparent 10px,rgba(0,0,0,.12) 10px,rgba(0,0,0,.12) 11px)}
.progress-txt{font-family:'Press Start 2P',monospace;color:var(--gold);font-size:7px;min-width:44px;text-align:right}
.score-display{font-family:'Press Start 2P',monospace;color:var(--gold);font-size:8px;text-shadow:0 0 8px var(--gold)}

#gameWrapper{position:relative;flex:1;display:flex;align-items:center;justify-content:center;background:#000;overflow:hidden}
canvas{display:block;image-rendering:pixelated;image-rendering:crisp-edges;}

#hintBar{width:100%;background:rgba(0,0,0,.6);border-top:1px solid #FFD70044;padding:4px 0;text-align:center;font-family:'Press Start 2P',monospace;font-size:6px;color:#FFD70099;letter-spacing:.5px;flex-shrink:0}

/* MODAL */
#modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.82);z-index:100;align-items:center;justify-content:center;backdrop-filter:blur(3px)}
#modal.show{display:flex}
.modal-box{background:linear-gradient(160deg,#1a0800,#0d0300);border:3px solid var(--gold);border-radius:6px;max-width:640px;width:94%;max-height:84vh;display:flex;flex-direction:column;box-shadow:0 0 40px #FFD70055;animation:mIn .18s ease}
@keyframes mIn{from{transform:scale(.92);opacity:0}to{transform:scale(1);opacity:1}}
.modal-header{background:linear-gradient(90deg,#8a0000,var(--red),#8a0000);padding:12px 18px;display:flex;align-items:center;justify-content:space-between;border-bottom:2px solid var(--gold);border-radius:4px 4px 0 0;flex-shrink:0}
.modal-era{font-size:10px;color:#FFD70099;font-style:italic;margin-top:2px}
.modal-title{font-family:'Press Start 2P',monospace;color:var(--gold);font-size:11px;text-shadow:0 0 10px #ffaa00}
.modal-badge{background:var(--gold);color:var(--rd);font-family:'Press Start 2P',monospace;font-size:7px;padding:3px 7px;border-radius:2px}
.modal-body{padding:20px 22px;overflow-y:auto;flex:1;color:#f0e0c0;line-height:1.9;font-size:15px;scrollbar-width:thin;scrollbar-color:var(--gold) #2a1000}
.modal-body::-webkit-scrollbar{width:5px}
.modal-body::-webkit-scrollbar-thumb{background:var(--gold);border-radius:3px}
.modal-footer{padding:10px 18px 12px;border-top:1px solid #FFD70033;display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.footer-hint{font-family:'Press Start 2P',monospace;color:#FFD70077;font-size:7px;animation:blink 1.2s infinite}
@keyframes blink{0%,100%{opacity:.4}50%{opacity:1}}
.btn-continue{font-family:'Press Start 2P',monospace;background:linear-gradient(180deg,var(--rl),var(--red));color:var(--gold);border:2px solid var(--gold);padding:9px 18px;font-size:9px;cursor:pointer;border-radius:3px;box-shadow:0 3px 0 var(--rd);transition:all .1s}
.btn-continue:hover{background:var(--gold);color:var(--rd)}
.btn-continue:active{transform:translateY(2px)}

/* TIMELINE OVERLAY */
#timelineOverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.92);z-index:145;align-items:center;justify-content:center;backdrop-filter:blur(4px)}
#timelineOverlay.show{display:flex}
.timeline-box{background:linear-gradient(160deg,#1a0800,#080200);border:3px solid var(--gold);border-radius:8px;max-width:720px;width:95%;max-height:90vh;display:flex;flex-direction:column;box-shadow:0 0 50px #FFD70044;animation:mIn .25s ease}
.timeline-header{background:linear-gradient(90deg,#7a0000,var(--red),#7a0000);padding:14px 20px;border-bottom:2px solid var(--gold);border-radius:6px 6px 0 0;display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.timeline-title{font-family:'Press Start 2P',monospace;color:var(--gold);font-size:10px}
.timeline-body{padding:16px 20px;overflow-y:auto;flex:1;scrollbar-width:thin;scrollbar-color:var(--gold) #1a0800}
.tl-period{margin-bottom:20px}
.tl-period-title{font-family:'Press Start 2P',monospace;color:var(--gold);font-size:8px;margin-bottom:10px;padding:6px 10px;background:rgba(255,215,0,.08);border-left:3px solid var(--gold)}
.tl-item{display:flex;gap:10px;margin-bottom:8px;align-items:flex-start}
.tl-dot{width:10px;height:10px;background:var(--gold);border-radius:50%;flex-shrink:0;margin-top:5px}
.tl-text{color:#f0e0c0;font-size:13px;line-height:1.6}
.tl-date{color:var(--gold);font-weight:700;font-size:12px}
.timeline-footer{padding:12px 20px;border-top:1px solid #FFD70022;display:flex;justify-content:flex-end;gap:10px;flex-shrink:0}
.btn-tl{font-family:'Press Start 2P',monospace;padding:9px 16px;font-size:8px;cursor:pointer;border-radius:3px;transition:all .1s}
.btn-tl.gold{background:var(--gold);color:var(--rd);border:2px solid var(--gd)}
.btn-tl.gold:hover{background:var(--gl)}
.btn-tl.outline{background:transparent;color:var(--gold);border:2px solid var(--gold)}
.btn-tl.outline:hover{background:var(--gold);color:var(--rd)}

/* QUIZ */
#quizOverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.9);z-index:160;align-items:center;justify-content:center;backdrop-filter:blur(4px)}
#quizOverlay.show{display:flex}
.quiz-box{background:linear-gradient(160deg,#1a0800,#080200);border:3px solid var(--gold);border-radius:8px;max-width:680px;width:95%;display:flex;flex-direction:column;box-shadow:0 0 50px #FFD70044;animation:mIn .2s ease;overflow:hidden}
.quiz-header{background:linear-gradient(90deg,#6a0000,var(--red),#6a0000);padding:12px 18px;border-bottom:2px solid var(--gold);display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.quiz-title{font-family:'Press Start 2P',monospace;color:var(--gold);font-size:9px}
.quiz-progress{font-family:'Press Start 2P',monospace;color:#FFD70099;font-size:7px}
.quiz-body{padding:20px 22px}
.quiz-q{color:#f0e0c0;font-size:15px;line-height:1.7;margin-bottom:18px;min-height:60px}
.quiz-q strong{color:var(--gold)}
.quiz-opts{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.quiz-opt{background:rgba(255,215,0,.06);border:2px solid #FFD70044;color:#f0e0c0;padding:12px 14px;border-radius:4px;cursor:pointer;font-size:13px;line-height:1.5;text-align:left;transition:all .15s;font-family:'Be Vietnam Pro',sans-serif}
.quiz-opt:hover:not(:disabled){background:rgba(255,215,0,.15);border-color:var(--gold);color:var(--gold)}
.quiz-opt.correct{background:rgba(0,180,80,.2);border-color:#00cc55;color:#88ffaa}
.quiz-opt.wrong{background:rgba(200,0,0,.2);border-color:#cc3333;color:#ffaaaa}
.quiz-opt:disabled{cursor:default}
.quiz-explanation{background:rgba(255,215,0,.06);border-left:3px solid var(--gold);padding:10px 14px;margin-top:14px;color:#f0d090;font-size:13px;line-height:1.6;border-radius:0 4px 4px 0;display:none}
.quiz-explanation.show{display:block}
.quiz-footer{padding:12px 22px 16px;display:flex;align-items:center;justify-content:space-between;border-top:1px solid #FFD70022}
.quiz-score-txt{font-family:'Press Start 2P',monospace;color:var(--gold);font-size:8px}
.btn-quiz-next{font-family:'Press Start 2P',monospace;background:linear-gradient(180deg,var(--rl),var(--red));color:var(--gold);border:2px solid var(--gold);padding:9px 16px;font-size:8px;cursor:pointer;border-radius:3px;box-shadow:0 2px 0 var(--rd);transition:all .1s}
.btn-quiz-next:hover{background:var(--gold);color:var(--rd)}
.quiz-result{padding:24px 22px;text-align:center}
.quiz-result-score{font-family:'Press Start 2P',monospace;font-size:28px;color:var(--gold);text-shadow:0 0 20px var(--gold);margin-bottom:10px}
.quiz-result-msg{color:#f0e0c0;font-size:15px;line-height:1.7;margin-bottom:18px}
.quiz-medals{font-size:32px;margin-bottom:12px}
.quiz-result-buttons{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}

/* VICTORY */
#victoryOverlay{display:none;position:fixed;inset:0;background:radial-gradient(ellipse at center,#2a0000,#0d0000);z-index:150;align-items:center;justify-content:center;flex-direction:column;gap:16px}
#victoryOverlay.show{display:flex}
.v-stars{font-size:40px;letter-spacing:8px;animation:starPop .6s ease}
@keyframes starPop{from{transform:scale(0) rotate(-30deg)}to{transform:scale(1) rotate(0)}}
.victory-title{font-family:'Press Start 2P',monospace;color:var(--gold);font-size:18px;text-align:center;text-shadow:0 0 30px var(--gold),0 0 60px #ff8800;animation:pulse 1.2s infinite alternate}
@keyframes pulse{from{opacity:.75;transform:scale(.98)}to{opacity:1;transform:scale(1)}}
.victory-sub{color:#f0d0a0;font-size:15px;text-align:center;line-height:1.7}
.v-buttons{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-top:8px}
.btn-v{font-family:'Press Start 2P',monospace;border:3px solid var(--gold);padding:12px 20px;font-size:9px;cursor:pointer;border-radius:4px;transition:all .1s}
.btn-v.primary{background:linear-gradient(180deg,var(--rl),var(--rd));color:var(--gold);box-shadow:0 4px 0 #550000,0 0 20px #FFD70055}
.btn-v.primary:hover{background:var(--gold);color:var(--rd)}
.btn-v.secondary{background:rgba(255,215,0,.1);color:var(--gold)}
.btn-v.secondary:hover{background:var(--gold);color:var(--rd)}

/* CHAT */
#chatOverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.88);z-index:200;align-items:center;justify-content:center;backdrop-filter:blur(4px)}
#chatOverlay.show{display:flex}
.chat-box{background:linear-gradient(160deg,#140800,#0a0200);border:3px solid var(--gold);border-radius:8px;width:min(720px,96vw);height:min(680px,94vh);display:flex;flex-direction:column;box-shadow:0 0 60px #FFD70044;animation:mIn .2s ease}
.chat-header{background:linear-gradient(90deg,#5a0000,var(--red),#5a0000);padding:0;border-bottom:2px solid var(--gold);border-radius:5px 5px 0 0;flex-shrink:0}
.chat-header-top{padding:12px 16px;display:flex;align-items:center;justify-content:space-between}
.chat-header-left{display:flex;align-items:center;gap:10px}
.chat-avatar{width:36px;height:36px;background:var(--gold);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
.chat-header-title{font-family:'Press Start 2P',monospace;color:var(--gold);font-size:7px;line-height:1.6}
.chat-header-sub{font-size:11px;color:#FFD70099;margin-top:2px}
.chat-tabs{display:flex;overflow-x:auto;border-top:1px solid #FFD70033;scrollbar-width:none;padding:0 10px;gap:4px}
.chat-tabs::-webkit-scrollbar{display:none}
.chat-tab{font-family:'Press Start 2P',monospace;font-size:6px;color:#FFD70077;background:none;border:none;border-bottom:2px solid transparent;padding:7px 10px;cursor:pointer;white-space:nowrap;transition:all .15s;flex-shrink:0}
.chat-tab:hover{color:var(--gold)}
.chat-tab.active{color:var(--gold);border-bottom-color:var(--gold)}
.chat-close{background:none;border:2px solid var(--gold);color:var(--gold);cursor:pointer;font-family:'Press Start 2P',monospace;font-size:8px;padding:5px 9px;border-radius:3px;transition:all .1s;flex-shrink:0}
.chat-close:hover{background:var(--gold);color:var(--rd)}
#chatMessages{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px;scrollbar-width:thin;scrollbar-color:var(--gd) #1a0800}
#chatMessages::-webkit-scrollbar{width:4px}
#chatMessages::-webkit-scrollbar-thumb{background:var(--gd);border-radius:3px}
.msg{max-width:84%;padding:11px 15px;border-radius:6px;font-size:14px;line-height:1.75;word-break:break-word}
.msg.user{background:linear-gradient(135deg,var(--red),var(--rd));color:#fff;align-self:flex-end;border:1px solid var(--gd);border-radius:6px 6px 2px 6px}
.msg.bot{background:linear-gradient(135deg,#221000,#150800);color:#f0e0c0;align-self:flex-start;border:1px solid #FFD70055;border-radius:6px 6px 6px 2px}
.msg.bot h2,.msg.bot h3{color:var(--gold);margin:8px 0 4px;font-size:14px}
.msg.bot ul,.msg.bot ol{padding-left:20px;margin:5px 0}
.msg.bot li{margin-bottom:3px}
.msg.bot code{background:#3a1800;padding:1px 5px;border-radius:3px;font-size:12px;color:var(--gold)}
.msg.bot strong{color:var(--gl)}
.msg.bot em{color:#ffc080}
.msg.bot blockquote{border-left:3px solid var(--gold);padding-left:10px;margin:6px 0;color:#ffd080;font-style:italic}
.msg-time{font-size:10px;opacity:.45;margin-top:5px;text-align:right}
.msg-era-tag{display:inline-block;background:var(--gold);color:var(--rd);font-size:9px;font-weight:700;padding:1px 6px;border-radius:2px;margin-bottom:6px}
.typing-dots{display:inline-flex;gap:4px;align-items:center;padding:4px 0}
.typing-dots span{width:7px;height:7px;background:var(--gold);border-radius:50%;animation:td 1.2s infinite}
.typing-dots span:nth-child(2){animation-delay:.2s}.typing-dots span:nth-child(3){animation-delay:.4s}
@keyframes td{0%,80%,100%{transform:scale(.6);opacity:.4}40%{transform:scale(1);opacity:1}}
.quick-prompts{padding:8px 14px;display:flex;gap:6px;flex-wrap:wrap;border-top:1px solid #FFD70022;flex-shrink:0}
.qp-btn{font-size:11px;background:rgba(255,215,0,.08);border:1px solid #FFD70044;color:#FFD70099;padding:4px 10px;border-radius:12px;cursor:pointer;transition:all .15s;white-space:nowrap}
.qp-btn:hover{background:rgba(255,215,0,.2);color:var(--gold);border-color:var(--gold)}
.chat-input-row{display:flex;gap:9px;padding:10px 14px 12px;border-top:1px solid #FFD70033;flex-shrink:0}
#chatInput{flex:1;background:#1a0a00;border:2px solid #FFD70066;color:#f0e0c0;padding:10px 13px;border-radius:4px;font-family:'Be Vietnam Pro',sans-serif;font-size:14px;resize:none;height:44px;transition:border-color .2s}
#chatInput:focus{outline:none;border-color:var(--gold);box-shadow:0 0 8px #FFD70033}
#chatInput::placeholder{color:#FFD70044}
#sendBtn{background:linear-gradient(180deg,var(--rl),var(--red));border:2px solid var(--gold);color:var(--gold);font-family:'Press Start 2P',monospace;font-size:8px;padding:0 14px;cursor:pointer;border-radius:4px;box-shadow:0 2px 0 var(--rd);min-width:60px;transition:all .1s}
#sendBtn:hover{background:var(--gold);color:var(--rd)}
#sendBtn:disabled{opacity:.4;cursor:not-allowed}
.chat-footer-note{text-align:center;padding:5px;font-family:'Press Start 2P',monospace;font-size:6px;color:#FFD70033;flex-shrink:0}

/* SCORE POPUP */
.score-popup{position:fixed;font-family:'Press Start 2P',monospace;font-size:14px;color:var(--gold);pointer-events:none;z-index:90;text-shadow:0 0 10px var(--gold);animation:scoreFloat 1.2s ease forwards}
@keyframes scoreFloat{0%{opacity:1;transform:translateY(0)}100%{opacity:0;transform:translateY(-60px)}}
</style>
</head>
<body>

<div id="hud">
  <div class="hud-left">
    <div class="hud-star">â­</div>
    <div class="hud-title">Lá»ŠCH Sá»¬ Äáº¢NG CSVN</div>
  </div>
  <div class="hud-right">
    <div class="score-display">â­ <span id="scoreDisplay">0</span></div>
    <div class="progress-wrap">
      <div class="progress-bar-bg"><div class="progress-bar-fill" id="progressFill" style="width:0%"></div></div>
      <div class="progress-txt" id="progressTxt">0 / 56</div>
    </div>
  </div>
</div>
<div id="gameWrapper">
  <canvas id="gameCanvas" width="900" height="480"></canvas>
</div>
<div id="hintBar">â† â†’ / A D : DI CHUYá»‚N &nbsp;|&nbsp; SPACE / â†‘ : NHáº¢Y &nbsp;|&nbsp; NHáº¢Y Äáº¬P VÃ€O Ã” ? Äá»‚ Äá»ŒC &nbsp;|&nbsp; ENTER : ÄÃ“NG Há»˜P</div>

<!-- Box Modal -->
<div id="modal">
  <div class="modal-box">
    <div class="modal-header">
      <div><div class="modal-title" id="modalTitle">BOX 1</div><div class="modal-era" id="modalEra"></div></div>
      <div class="modal-badge" id="modalBadge">1 / 56</div>
    </div>
    <div class="modal-body" id="modalBody"></div>
    <div class="modal-footer">
      <div class="footer-hint">[ ENTER ] TIáº¾P Tá»¤C</div>
      <button class="btn-continue" id="btnContinue">âœ“ TIáº¾P Tá»¤C</button>
    </div>
  </div>
</div>

<!-- Timeline -->
<div id="timelineOverlay">
  <div class="timeline-box">
    <div class="timeline-header">
      <div class="timeline-title">ğŸ“… Báº¢NG TÃ“M Táº®T Lá»ŠCH Sá»¬ 1929â€“1939</div>
      <button class="btn-tl outline" id="btnCloseTimeline">âœ•</button>
    </div>
    <div class="timeline-body" id="timelineBody"></div>
    <div class="timeline-footer">
      <button class="btn-tl outline" id="btnTimelineToQuiz">ğŸ“ LÃ€M BÃ€I Ã”N Táº¬P</button>
      <button class="btn-tl gold" id="btnTimelineToChat">ğŸ¤– VÃ€O AI CHAT</button>
    </div>
  </div>
</div>

<!-- Quiz -->
<div id="quizOverlay">
  <div class="quiz-box" id="quizBox">
    <div class="quiz-header">
      <div class="quiz-title">ğŸ“ Ã”N Táº¬P Lá»ŠCH Sá»¬</div>
      <div class="quiz-progress" id="quizProgress">CÃ¢u 1 / 10</div>
    </div>
    <div id="quizContent"></div>
  </div>
</div>

<!-- Victory -->
<div id="victoryOverlay">
  <div class="v-stars">â­â­â­â­â­</div>
  <div class="victory-title">HOÃ€N THÃ€NH 56 BOX!</div>
  <div class="victory-sub">Äiá»ƒm sá»‘: <strong style="color:#FFD700" id="victoryScore">0</strong> Ä‘iá»ƒm<br>Báº¡n Ä‘Ã£ há»c xong <strong style="color:#FFD700">Lá»‹ch sá»­ Äáº£ng CSVN 1929â€“1939</strong></div>
  <div class="v-buttons">
    <button class="btn-v secondary" id="btnShowTimeline">ğŸ“… XEM TIMELINE</button>
    <button class="btn-v secondary" id="btnStartQuiz">ğŸ“ Ã”N Táº¬P (10 CÃ‚U)</button>
    <button class="btn-v primary"   id="btnOpenChat">ğŸ¤– VÃ€O AI CHAT</button>
    <button class="btn-v secondary" id="btnRestart">â†º CHÆ I Láº I</button>
  </div>
</div>

<!-- Chat -->
<div id="chatOverlay">
  <div class="chat-box">
    <div class="chat-header">
      <div class="chat-header-top">
        <div class="chat-header-left">
          <div class="chat-avatar">ğŸ“œ</div>
          <div>
            <div class="chat-header-title">TRUNG TÃ‚M THáº¢O LUáº¬N Lá»ŠCH Sá»¬</div>
            <div class="chat-header-sub">Lá»‹ch sá»­ Äáº£ng CSVN 1929â€“1939 Â· Groq llama-3.3-70b</div>
          </div>
        </div>
        <button class="chat-close" id="chatCloseBtn">âœ• ÄÃ“NG</button>
      </div>
      <div class="chat-tabs" id="chatTabs"></div>
    </div>
    <div id="chatMessages"></div>
    <div class="quick-prompts" id="quickPrompts"></div>
    <div class="chat-input-row">
      <textarea id="chatInput" placeholder="Äáº·t cÃ¢u há»i vá» lá»‹ch sá»­..."></textarea>
      <button id="sendBtn">Gá»¬I</button>
    </div>
    <div class="chat-footer-note">ENTER gá»­i Â· SHIFT+ENTER xuá»‘ng dÃ²ng Â· Groq llama-3.3-70b-versatile</div>
  </div>
</div>

<script>
// ============================================================
// CONFIG â€” KHÃ”NG cÃ²n API key á»Ÿ Ä‘Ã¢y, Ä‘Ã£ chuyá»ƒn lÃªn server
// ============================================================
const GROQ_MODEL = 'llama-3.3-70b-versatile';

// ============================================================
// FULLSCREEN SCALE
// ============================================================
const canvas = document.getElementById('gameCanvas');
const wrapper = document.getElementById('gameWrapper');
const CW = 900, CH = 480;

function resizeCanvas() {
  const ww = wrapper.clientWidth, wh = wrapper.clientHeight;
  const scale = Math.min(ww / CW, wh / CH);
  canvas.style.width  = (CW * scale) + 'px';
  canvas.style.height = (CH * scale) + 'px';
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// ============================================================
// TIMELINE DATA
// ============================================================
const TIMELINE_PERIODS = [
  { title:'1929â€“1930 Â· Khá»§ng hoáº£ng & BÃ¹ng ná»•', items:[
    {date:'1929â€“1933',text:'Khá»§ng hoáº£ng kinh táº¿ tháº¿ giá»›i â€” tÆ° báº£n lao Ä‘ao, phong trÃ o cÃ¡ch máº¡ng toÃ n cáº§u dÃ¢ng cao'},
    {date:'2/1930',text:'Khá»Ÿi nghÄ©a YÃªn BÃ¡i bá»‹ Ä‘Ã n Ã¡p â€” PhÃ¡p tÄƒng cÆ°á»ng bÃ³c lá»™t ÄÃ´ng DÆ°Æ¡ng'},
    {date:'1â€“4/1930',text:'BÃ£i cÃ´ng cÃ´ng nhÃ¢n liÃªn tiáº¿p: xi mÄƒng Háº£i PhÃ²ng, PhÃº Riá»ng, dá»‡t Nam Äá»‹nh...'},
    {date:'5/1930',text:'Quá»‘c táº¿ Lao Ä‘á»™ng: 16 bÃ£i cÃ´ng, 34 biá»ƒu tÃ¬nh nÃ´ng dÃ¢n'},
    {date:'6â€“8/1930',text:'121 cuá»™c Ä‘áº¥u tranh â€” tá»•ng bÃ£i cÃ´ng Báº¿n Thá»§yâ€“Vinh'},
    {date:'12/9/1930',text:'Biá»ƒu tÃ¬nh HÆ°ng NguyÃªn: mÃ¡y bay PhÃ¡p nÃ©m bom, 171 ngÆ°á»i thiá»‡t máº¡ng'},
  ]},
  { title:'10/1930â€“1931 Â· Há»™i nghá»‹ TW & ÄÃ n Ã¡p', items:[
    {date:'14â€“31/10/1930',text:'Há»™i nghá»‹ TW I táº¡i HÆ°Æ¡ng Cáº£ng: Ä‘á»•i tÃªn Äáº£ng â†’ Äáº£ng Cá»™ng sáº£n ÄÃ´ng DÆ°Æ¡ng; Tráº§n PhÃº lÃ m Tá»•ng BÃ­ thÆ°'},
    {date:'10/1930',text:'Luáº­n cÆ°Æ¡ng chÃ­nh trá»‹ Tráº§n PhÃº â€” xÃ¡c Ä‘á»‹nh chiáº¿n lÆ°á»£c cÃ¡ch máº¡ng'},
    {date:'18/11/1930',text:'Chá»‰ thá»‹ thÃ nh láº­p Há»™i Pháº£n Ä‘áº¿ Äá»“ng minh â€” máº·t tráº­n Ä‘áº§u tiÃªn'},
    {date:'11/4/1931',text:'Quá»‘c táº¿ Cá»™ng sáº£n cÃ´ng nháº­n Äáº£ng Cá»™ng sáº£n ÄÃ´ng DÆ°Æ¡ng lÃ  chi bá»™ Ä‘á»™c láº­p'},
    {date:'18/4/1931',text:'Tráº§n PhÃº bá»‹ báº¯t táº¡i SÃ i GÃ²n'},
    {date:'4/1931',text:'ToÃ n bá»™ Ban Cháº¥p hÃ nh TW bá»‹ báº¯t â€” tá»• chá»©c tan rÃ£ háº§u háº¿t'},
    {date:'6/6/1931',text:'Nguyá»…n Ãi Quá»‘c bá»‹ chÃ­nh quyá»n Anh báº¯t táº¡i Há»“ng KÃ´ng'},
    {date:'6/9/1931',text:'Tráº§n PhÃº hy sinh: "HÃ£y giá»¯ vá»¯ng chÃ­ khÃ­ chiáº¿n Ä‘áº¥u!"'},
  ]},
  { title:'1932â€“1935 Â· Phá»¥c há»“i Tá»• chá»©c', items:[
    {date:'Äáº§u 1932',text:'LÃª Há»“ng Phong cÃ´ng bá»‘ ChÆ°Æ¡ng trÃ¬nh hÃ nh Ä‘á»™ng â€” khá»Ÿi Ä‘á»™ng phá»¥c há»“i'},
    {date:'15/6/1932',text:'ChÆ°Æ¡ng trÃ¬nh hÃ nh Ä‘á»™ng: "gÃ¢y dá»±ng Ä‘oÃ n thá»ƒ bÃ­ máº­t vá»¯ng nhÆ° sáº¯t Ä‘á»“ng"'},
    {date:'3/1933',text:'HÃ  Huy Táº­p viáº¿t SÆ¡ tháº£o lá»‹ch sá»­ phong trÃ o cá»™ng sáº£n ÄÃ´ng DÆ°Æ¡ng'},
    {date:'5/1933',text:'TÃ²a Äáº¡i hÃ¬nh SÃ i GÃ²n xÃ©t xá»­ 120 chiáº¿n sÄ©, Ä‘Ã y ra CÃ´n Äáº£o'},
    {date:'Äáº§u 1934',text:'Nguyá»…n Ãi Quá»‘c ra tÃ¹, trá»Ÿ láº¡i Quá»‘c táº¿ Cá»™ng sáº£n (MÃ¡txcÆ¡va)'},
    {date:'Äáº§u 1934',text:'Ban Chá»‰ huy á»Ÿ ngoÃ i Ä‘Æ°á»£c thÃ nh láº­p'},
    {date:'3/1935',text:'Äáº¡i há»™i Äáº£ng I táº¡i Ma Cao: LÃª Há»“ng Phong lÃ m TBT, 3 nhiá»‡m vá»¥ trÆ°á»›c máº¯t'},
  ]},
  { title:'1935â€“1939 Â· Phong trÃ o DÃ¢n chá»§', items:[
    {date:'7/1935',text:'Äáº¡i há»™i VII Quá»‘c táº¿ Cá»™ng sáº£n: xÃ¡c Ä‘á»‹nh chá»‘ng phÃ¡t xÃ­t lÃ  nhiá»‡m vá»¥ hÃ ng Ä‘áº§u'},
    {date:'1936',text:'Máº·t tráº­n NhÃ¢n dÃ¢n PhÃ¡p tháº¯ng cá»­ â€” táº¡o Ä‘iá»u kiá»‡n thuáº­n lá»£i cho ÄÃ´ng DÆ°Æ¡ng'},
    {date:'26/7/1936',text:'Há»™i nghá»‹ TW táº¡i ThÆ°á»£ng Háº£i: "sá»­a chá»¯a sai láº§m, Ä‘á»‹nh láº¡i chÃ­nh sÃ¡ch má»›i"'},
    {date:'10/1936',text:'VÄƒn kiá»‡n "Chiáº¿n sÃ¡ch má»›i": Æ°u tiÃªn pháº£n Ä‘áº¿ trÆ°á»›c Ä‘iá»n Ä‘á»‹a'},
    {date:'8/1936',text:'HÃ  Huy Táº­p lÃ m Tá»•ng BÃ­ thÆ° (Ä‘áº¿n 3/1938)'},
    {date:'1936',text:'600 á»¦y ban hÃ nh Ä‘á»™ng á»Ÿ Nam Ká»³; phong trÃ o ÄÃ´ng DÆ°Æ¡ng Äáº¡i há»™i'},
    {date:'3/1938',text:'Há»™i nghá»‹ TW: láº­p Máº·t tráº­n DÃ¢n chá»§ ÄÃ´ng DÆ°Æ¡ng; Nguyá»…n VÄƒn Cá»« lÃ m TBT'},
    {date:'1939',text:'Nguyá»…n VÄƒn Cá»« xuáº¥t báº£n Tá»± chá»‰ trÃ­ch'},
    {date:'9/1939',text:'Chiáº¿n tranh TG2 bÃ¹ng ná»• â€” Äáº£ng rÃºt vÃ o bÃ­ máº­t, káº¿t thÃºc giai Ä‘oáº¡n dÃ¢n chá»§'},
  ]},
];

// ============================================================
// QUIZ QUESTIONS
// ============================================================
const ALL_QUESTIONS = [
  {q:'Cuá»™c khá»Ÿi nghÄ©a nÃ o bá»‹ Ä‘Ã n Ã¡p vÃ o thÃ¡ng 2/1930, khiáº¿n PhÃ¡p tiáº¿n hÃ nh "khá»§ng bá»‘ tráº¯ng" á»Ÿ ÄÃ´ng DÆ°Æ¡ng?',opts:['Khá»Ÿi nghÄ©a YÃªn BÃ¡i','Khá»Ÿi nghÄ©a Nam Ká»³','Khá»Ÿi nghÄ©a Báº¯c SÆ¡n','Khá»Ÿi nghÄ©a HÆ°Æ¡ng KhÃª'],ans:0,exp:'Khá»Ÿi nghÄ©a YÃªn BÃ¡i (2/1930) do Viá»‡t Nam Quá»‘c dÃ¢n Äáº£ng lÃ£nh Ä‘áº¡o bá»‹ Ä‘Ã n Ã¡p, khiáº¿n PhÃ¡p tÄƒng cÆ°á»ng khá»§ng bá»‘ toÃ n ÄÃ´ng DÆ°Æ¡ng.'},
  {q:'Há»™i nghá»‹ TW láº§n thá»© nháº¥t (10/1930) quyáº¿t Ä‘á»‹nh Ä‘á»•i tÃªn Äáº£ng thÃ nh gÃ¬?',opts:['Äáº£ng Cá»™ng sáº£n ÄÃ´ng DÆ°Æ¡ng','Äáº£ng Lao Ä‘á»™ng Viá»‡t Nam','Äáº£ng NhÃ¢n dÃ¢n CÃ¡ch máº¡ng','Äáº£ng Cá»™ng sáº£n Viá»‡t Nam'],ans:0,exp:'Há»™i nghá»‹ táº¡i HÆ°Æ¡ng Cáº£ng (Há»“ng KÃ´ng) quyáº¿t Ä‘á»‹nh Ä‘á»•i tÃªn tá»« Äáº£ng Cá»™ng sáº£n Viá»‡t Nam thÃ nh Äáº£ng Cá»™ng sáº£n ÄÃ´ng DÆ°Æ¡ng.'},
  {q:'Ai Ä‘Æ°á»£c báº§u lÃ m Tá»•ng BÃ­ thÆ° táº¡i Há»™i nghá»‹ TW láº§n I (10/1930)?',opts:['Tráº§n PhÃº','LÃª Há»“ng Phong','HÃ  Huy Táº­p','Nguyá»…n VÄƒn Cá»«'],ans:0,exp:'Äá»“ng chÃ­ Tráº§n PhÃº Ä‘Æ°á»£c báº§u lÃ m Tá»•ng BÃ­ thÆ° Ä‘áº§u tiÃªn cá»§a Äáº£ng Cá»™ng sáº£n ÄÃ´ng DÆ°Æ¡ng táº¡i Há»™i nghá»‹ HÆ°Æ¡ng Cáº£ng.'},
  {q:'TrÆ°á»›c lÃºc hy sinh, Tá»•ng BÃ­ thÆ° Tráº§n PhÃº cÄƒn dáº·n: "HÃ£y..."?',opts:['"Giá»¯ vá»¯ng chÃ­ khÃ­ chiáº¿n Ä‘áº¥u!"','"Tiáº¿n lÃªn phÃ­a trÆ°á»›c!"','"Báº£o vá»‡ Äáº£ng Ä‘áº¿n cÃ¹ng!"','"ÄoÃ n káº¿t lÃ  sá»©c máº¡nh!"'],ans:0,exp:'Tráº§n PhÃº hy sinh ngÃ y 6/9/1931 táº¡i NhÃ  thÆ°Æ¡ng Chá»£ QuÃ¡n, SÃ i GÃ²n. Lá»i cuá»‘i: "HÃ£y giá»¯ vá»¯ng chÃ­ khÃ­ chiáº¿n Ä‘áº¥u!"'},
  {q:'LÃ½ Tá»± Trá»ng trÆ°á»›c lÃºc hy sinh Ä‘Ã£ nÃ³i cÃ¢u nÃ o ná»•i tiáº¿ng?',opts:['"Con Ä‘Æ°á»ng cá»§a thanh niÃªn chá»‰ cÃ³ thá»ƒ lÃ  con Ä‘Æ°á»ng cÃ¡ch máº¡ng"','"Cháº¿t vÃ¬ Tá»• quá»‘c lÃ  vinh dá»± nháº¥t"','"MÃ¡u Ä‘Ã o pháº£i Ä‘á»•i láº¥y tá»± do"','"Tuá»•i tráº» lÃ  Ã¡nh sÃ¡ng tÆ°Æ¡ng lai"'],ans:0,exp:'LÃ½ Tá»± Trá»ng â€” ngÆ°á»i thanh niÃªn cá»™ng sáº£n kiÃªn trung, Ä‘á»ƒ láº¡i cÃ¢u nÃ³i báº¥t há»§ vá» con Ä‘Æ°á»ng cÃ¡ch máº¡ng cá»§a tháº¿ há»‡ tráº».'},
  {q:'Äáº¡i há»™i Äáº£ng láº§n thá»© I Ä‘Æ°á»£c tá»• chá»©c á»Ÿ Ä‘Ã¢u vÃ o thÃ¡ng 3/1935?',opts:['Ma Cao (Trung Quá»‘c)','HÆ°Æ¡ng Cáº£ng (Há»“ng KÃ´ng)','ThÆ°á»£ng Háº£i (Trung Quá»‘c)','MÃ¡txcÆ¡va (LiÃªn XÃ´)'],ans:0,exp:'Äáº¡i há»™i Ä‘áº¡i biá»ƒu láº§n thá»© I cá»§a Äáº£ng há»p táº¡i Ma Cao (Trung Quá»‘c) vÃ o thÃ¡ng 3/1935, do LÃª Há»“ng Phong lÃ m Tá»•ng BÃ­ thÆ°.'},
  {q:'Äáº¡i há»™i VII Quá»‘c táº¿ Cá»™ng sáº£n (7/1935) xÃ¡c Ä‘á»‹nh káº» thÃ¹ nguy hiá»ƒm nháº¥t trÆ°á»›c máº¯t lÃ  gÃ¬?',opts:['Chá»§ nghÄ©a phÃ¡t xÃ­t','Chá»§ nghÄ©a thá»±c dÃ¢n','Chá»§ nghÄ©a Ä‘áº¿ quá»‘c','Chá»§ nghÄ©a tÆ° báº£n'],ans:0,exp:'Äáº¡i há»™i VII (MÃ¡txcÆ¡va, 7/1935) xÃ¡c Ä‘á»‹nh chá»§ nghÄ©a phÃ¡t xÃ­t lÃ  káº» thÃ¹ nguy hiá»ƒm nháº¥t, Ä‘áº·t nhiá»‡m vá»¥ chá»‘ng phÃ¡t xÃ­t lÃªn hÃ ng Ä‘áº§u.'},
  {q:'Há»™i nghá»‹ TW táº¡i ThÆ°á»£ng Háº£i (26/7/1936) do ai chá»§ trÃ¬?',opts:['LÃª Há»“ng Phong','HÃ  Huy Táº­p','Nguyá»…n VÄƒn Cá»«','Tráº§n PhÃº'],ans:0,exp:'Há»™i nghá»‹ 26/7/1936 táº¡i ThÆ°á»£ng Háº£i do Ä‘á»“ng chÃ­ LÃª Há»“ng Phong chá»§ trÃ¬, nháº±m "sá»­a chá»¯a sai láº§m vÃ  Ä‘á»‹nh láº¡i chÃ­nh sÃ¡ch má»›i".'},
  {q:'VÄƒn kiá»‡n "Chung quanh váº¥n Ä‘á» chiáº¿n sÃ¡ch má»›i" (10/1936) Ä‘á» ra quan Ä‘iá»ƒm gÃ¬ vá» Ä‘iá»n Ä‘á»‹a vÃ  pháº£n Ä‘áº¿?',opts:['Pháº£n Ä‘áº¿ khÃ´ng nháº¥t thiáº¿t pháº£i gáº¯n vá»›i Ä‘iá»n Ä‘á»‹a','Äiá»n Ä‘á»‹a pháº£i Ä‘i trÆ°á»›c pháº£n Ä‘áº¿','Hai nhiá»‡m vá»¥ pháº£i tiáº¿n hÃ nh song song','Äiá»n Ä‘á»‹a quyáº¿t Ä‘á»‹nh tháº¯ng lá»£i cÃ¡ch máº¡ng'],ans:0,exp:'Äáº£ng nÃªu: cuá»™c dÃ¢n tá»™c giáº£i phÃ³ng khÃ´ng nháº¥t Ä‘á»‹nh pháº£i káº¿t cháº·t vá»›i Ä‘iá»n Ä‘á»‹a â€” náº¿u mÃ¢u thuáº«n thÃ¬ Æ°u tiÃªn nhiá»‡m vá»¥ quan trá»ng hÆ¡n.'},
  {q:'Nguyá»…n VÄƒn Cá»« xuáº¥t báº£n cuá»‘n sÃ¡ch nÃ o nÄƒm 1939?',opts:['Tá»± chá»‰ trÃ­ch','SÆ¡ tháº£o lá»‹ch sá»­','Tá»rá»‘txky vÃ  pháº£n cÃ¡ch máº¡ng','Luáº­n cÆ°Æ¡ng chÃ­nh trá»‹'],ans:0,exp:'Tá»•ng BÃ­ thÆ° Nguyá»…n VÄƒn Cá»« xuáº¥t báº£n "Tá»± chá»‰ trÃ­ch" (1939), tháº³ng tháº¯n chá»‰ ra sai láº§m vÃ  bÃ i há»c lÃ£nh Ä‘áº¡o cá»§a Äáº£ng.'},
  {q:'Cuá»™c biá»ƒu tÃ¬nh nÃ´ng dÃ¢n ngÃ y 12/9/1930 á»Ÿ Ä‘Ã¢u bá»‹ mÃ¡y bay PhÃ¡p nÃ©m bom lÃ m cháº¿t 171 ngÆ°á»i?',opts:['HÆ°ng NguyÃªn (Nghá»‡ An)','HÃ  TÄ©nh','ThÃ¡i BÃ¬nh','Nam Äá»‹nh'],ans:0,exp:'Cuá»™c biá»ƒu tÃ¬nh cá»§a nÃ´ng dÃ¢n HÆ°ng NguyÃªn (Nghá»‡ An) ngÃ y 12/9/1930 â€” sá»± kiá»‡n Ä‘á»‰nh cao cá»§a phong trÃ o XÃ´ viáº¿t Nghá»‡ TÄ©nh.'},
  {q:'Tá»« thÃ¡ng 6 Ä‘áº¿n thÃ¡ng 8/1930 Ä‘Ã£ ná»• ra bao nhiÃªu cuá»™c Ä‘áº¥u tranh?',opts:['121 cuá»™c','84 cuá»™c','56 cuá»™c','200 cuá»™c'],ans:0,exp:'121 cuá»™c Ä‘áº¥u tranh trong 3 thÃ¡ng, Ä‘á»‰nh Ä‘iá»ƒm lÃ  cuá»™c tá»•ng bÃ£i cÃ´ng cá»§a cÃ´ng nhÃ¢n khu cÃ´ng nghiá»‡p Báº¿n Thá»§yâ€“Vinh (8/1930).'},
  {q:'Nguyá»…n Ãi Quá»‘c bá»‹ báº¯t á»Ÿ Ä‘Ã¢u ngÃ y 6/6/1931?',opts:['Há»“ng KÃ´ng','ThÆ°á»£ng Háº£i','MÃ¡txcÆ¡va','Quáº£ng ChÃ¢u'],ans:0,exp:'Nguyá»…n Ãi Quá»‘c bá»‹ chÃ­nh quyá»n Anh báº¯t táº¡i Há»“ng KÃ´ng ngÃ y 6/6/1931. NgÆ°á»i Ä‘Æ°á»£c tráº£ tá»± do sau Ä‘Ã³ vÃ  trá»Ÿ láº¡i LiÃªn XÃ´ nÄƒm 1934.'},
  {q:'Chá»‰ thá»‹ ngÃ y 18/11/1930 thÃ nh láº­p tá»• chá»©c máº·t tráº­n Ä‘áº§u tiÃªn cÃ³ tÃªn lÃ  gÃ¬?',opts:['Há»™i Pháº£n Ä‘áº¿ Äá»“ng minh','Máº·t tráº­n DÃ¢n chá»§ ÄÃ´ng DÆ°Æ¡ng','Há»™i LiÃªn hiá»‡p Quá»‘c dÃ¢n Viá»‡t Nam','Máº·t tráº­n Viá»‡t Minh'],ans:0,exp:'NgÃ y 18/11/1930, ThÆ°á»ng vá»¥ TW Äáº£ng ban hÃ nh Chá»‰ thá»‹ vá» viá»‡c thÃ nh láº­p Há»™i Pháº£n Ä‘áº¿ Äá»“ng minh â€” tá»• chá»©c máº·t tráº­n Ä‘áº§u tiÃªn.'},
  {q:'Há»™i nghá»‹ TW thÃ¡ng 3/1938 báº§u ai lÃ m Tá»•ng BÃ­ thÆ° cá»§a Äáº£ng?',opts:['Nguyá»…n VÄƒn Cá»«','HÃ  Huy Táº­p','LÃª Há»“ng Phong','Nguyá»…n Thá»‹ Minh Khai'],ans:0,exp:'Há»™i nghá»‹ 29â€“30/3/1938 báº§u Ä‘á»“ng chÃ­ Nguyá»…n VÄƒn Cá»« lÃ m Tá»•ng BÃ­ thÆ°, Ä‘á»“ng thá»i quyáº¿t Ä‘á»‹nh láº­p Máº·t tráº­n DÃ¢n chá»§ ÄÃ´ng DÆ°Æ¡ng.'},
  {q:'RiÃªng á»Ÿ Nam Ká»³ cÃ³ bao nhiÃªu "á»§y ban hÃ nh Ä‘á»™ng" Ä‘Æ°á»£c thÃ nh láº­p nÄƒm 1936?',opts:['600','100','250','1000'],ans:0,exp:'Phong trÃ o ÄÃ´ng DÆ°Æ¡ng Äáº¡i há»™i nÄƒm 1936 lan rá»™ng, riÃªng Nam Ká»³ cÃ³ 600 "á»§y ban hÃ nh Ä‘á»™ng" Ä‘Æ°á»£c láº­p ra trong thá»i gian ngáº¯n.'},
  {q:'BÃ¡o bÃ­ máº­t "Ã kiáº¿n chung" Ä‘Æ°á»£c xuáº¥t báº£n táº¡i nhÃ  tÃ¹ nÃ o?',opts:['CÃ´n Äáº£o','Há»a LÃ² (HÃ  Ná»™i)','KhÃ¡m Lá»›n (SÃ i GÃ²n)','Vinh'],ans:0,exp:'Tá» bÃ¡o bÃ­ máº­t "Ã kiáº¿n chung" Ä‘Æ°á»£c cÃ¡c chi bá»™ Ä‘áº£ng trong tÃ¹ táº¡i CÃ´n Äáº£o xuáº¥t báº£n phá»¥c vá»¥ há»c táº­p vÃ  Ä‘áº¥u tranh tÆ° tÆ°á»Ÿng.'},
  {q:'ChÆ°Æ¡ng trÃ¬nh hÃ nh Ä‘á»™ng cá»§a Äáº£ng Cá»™ng sáº£n ÄÃ´ng DÆ°Æ¡ng Ä‘Æ°á»£c cÃ´ng bá»‘ vÃ o ngÃ y nÃ o?',opts:['15/6/1932','26/7/1936','14/10/1930','3/1935'],ans:0,exp:'ChÆ°Æ¡ng trÃ¬nh hÃ nh Ä‘á»™ng (15/6/1932) do LÃª Há»“ng Phong cÃ´ng bá»‘, váº¡ch rÃµ nhiá»‡m vá»¥ khÃ´i phá»¥c tá»• chá»©c Äáº£ng sau Ä‘Ã n Ã¡p tráº¯ng.'},
  {q:'HÃ  Huy Táº­p lÃ m Tá»•ng BÃ­ thÆ° trong khoáº£ng thá»i gian nÃ o?',opts:['8/1936 â€“ 3/1938','3/1935 â€“ 8/1936','3/1938 â€“ 9/1939','1931 â€“ 1935'],ans:0,exp:'Äá»“ng chÃ­ HÃ  Huy Táº­p lÃ  Tá»•ng BÃ­ thÆ° tá»« thÃ¡ng 8/1936 Ä‘áº¿n thÃ¡ng 3/1938, giai Ä‘oáº¡n phong trÃ o dÃ¢n chá»§ phÃ¡t triá»ƒn máº¡nh.'},
  {q:'Phong trÃ o truyá»n bÃ¡ quá»‘c ngá»¯ phÃ¡t triá»ƒn máº¡nh tá»« thá»i Ä‘iá»ƒm nÃ o?',opts:['Cuá»‘i nÄƒm 1937','Äáº§u nÄƒm 1936','Sau 1939','NÄƒm 1930'],ans:0,exp:'Tá»« cuá»‘i nÄƒm 1937, phong trÃ o truyá»n bÃ¡ quá»‘c ngá»¯ phÃ¡t triá»ƒn máº¡nh, gÃ³p pháº§n nÃ¢ng cao dÃ¢n trÃ­ trong phong trÃ o dÃ¢n chá»§.'},
  {q:'NgÃ y 4/1938, Äáº£ng cÃ³ bao nhiÃªu Ä‘áº£ng viÃªn hoáº¡t Ä‘á»™ng bÃ­ máº­t?',opts:['1.597 ngÆ°á»i','3.000 ngÆ°á»i','500 ngÆ°á»i','10.000 ngÆ°á»i'],ans:0,exp:'ThÃ¡ng 4/1938, Äáº£ng cÃ³ 1.597 Ä‘áº£ng viÃªn bÃ­ máº­t vÃ  hÆ¡n 200 Ä‘áº£ng viÃªn cÃ´ng khai; tá»• chá»©c quáº§n chÃºng cÃ³ 35.009 há»™i viÃªn.'},
  {q:'ToÃ  Ã¡n Äáº¡i hÃ¬nh SÃ i GÃ²n nÄƒm 1933 xÃ©t xá»­ bao nhiÃªu chiáº¿n sÄ© cá»™ng sáº£n?',opts:['120 ngÆ°á»i','56 ngÆ°á»i','200 ngÆ°á»i','84 ngÆ°á»i'],ans:0,exp:'Tá»« 2â€“9/5/1933, TÃ²a Äáº¡i hÃ¬nh SÃ i GÃ²n xÃ©t xá»­ 120 chiáº¿n sÄ© cá»™ng sáº£n, Ä‘Ã y ra CÃ´n Äáº£o (trong Ä‘Ã³ cÃ³ Pháº¡m HÃ¹ng, NgÃ´ Gia Tá»±...).'},
  {q:'Ban Chá»‰ huy á»Ÿ ngoÃ i cá»§a Äáº£ng Ä‘Æ°á»£c thÃ nh láº­p vÃ o thá»i gian nÃ o?',opts:['Äáº§u nÄƒm 1934','ThÃ¡ng 3/1935','ThÃ¡ng 6/1932','ThÃ¡ng 10/1930'],ans:0,exp:'Äáº§u nÄƒm 1934, theo chá»‰ Ä‘áº¡o cá»§a Quá»‘c táº¿ Cá»™ng sáº£n, Ban Chá»‰ huy á»Ÿ ngoÃ i Ä‘Æ°á»£c thÃ nh láº­p Ä‘á»ƒ lÃ£nh Ä‘áº¡o phong trÃ o trong nÆ°á»›c.'},
  {q:'Quá»‘c táº¿ Cá»™ng sáº£n cÃ´ng nháº­n Äáº£ng Cá»™ng sáº£n ÄÃ´ng DÆ°Æ¡ng lÃ  chi bá»™ Ä‘á»™c láº­p vÃ o ngÃ y nÃ o?',opts:['11/4/1931','6/9/1931','18/11/1930','15/6/1932'],ans:0,exp:'NgÃ y 11/4/1931, Quá»‘c táº¿ Cá»™ng sáº£n ra Nghá»‹ quyáº¿t cÃ´ng nháº­n Äáº£ng Cá»™ng sáº£n ÄÃ´ng DÆ°Æ¡ng lÃ  chi bá»™ Ä‘á»™c láº­p.'},
  {q:'Sá»± kiá»‡n nÃ o Ä‘Ã¡nh dáº¥u káº¿t thÃºc phong trÃ o váº­n Ä‘á»™ng dÃ¢n chá»§ 1936â€“1939?',opts:['Chiáº¿n tranh TG2 bÃ¹ng ná»• (9/1939)','Máº·t tráº­n NhÃ¢n dÃ¢n PhÃ¡p sá»¥p Ä‘á»•','Nguyá»…n VÄƒn Cá»« bá»‹ báº¯t','Äáº¡i há»™i Äáº£ng II'],ans:0,exp:'ThÃ¡ng 9/1939, Chiáº¿n tranh tháº¿ giá»›i thá»© hai bÃ¹ng ná»• â€” PhÃ¡p Ä‘Ã n Ã¡p cÃ¡ch máº¡ng, Äáº£ng rÃºt vÃ o bÃ­ máº­t, cháº¥m dá»©t giai Ä‘oáº¡n dÃ¢n chá»§.'},
  {q:'HÃ  Huy Táº­p viáº¿t tÃ¡c pháº©m nÃ o vÃ o thÃ¡ng 3/1933?',opts:['SÆ¡ tháº£o lá»‹ch sá»­ phong trÃ o cá»™ng sáº£n ÄÃ´ng DÆ°Æ¡ng','Tá»± chá»‰ trÃ­ch','Luáº­n cÆ°Æ¡ng chÃ­nh trá»‹','Tá»rá»‘txky vÃ  pháº£n cÃ¡ch máº¡ng'],ans:0,exp:'"SÆ¡ tháº£o lá»‹ch sá»­ phong trÃ o cá»™ng sáº£n ÄÃ´ng DÆ°Æ¡ng" (3/1933) â€” tÃ¡c pháº©m Ä‘áº§u tiÃªn tá»•ng káº¿t lá»‹ch sá»­ Äáº£ng, kháº³ng Ä‘á»‹nh vai trÃ² Nguyá»…n Ãi Quá»‘c.'},
  {q:'NgÃ y Quá»‘c táº¿ Lao Ä‘á»™ng 5/1930, ná»• ra bao nhiÃªu cuá»™c bÃ£i cÃ´ng cá»§a cÃ´ng nhÃ¢n?',opts:['16 cuá»™c','34 cuá»™c','4 cuá»™c','56 cuá»™c'],ans:0,exp:'NgÃ y 5/1930: 16 cuá»™c bÃ£i cÃ´ng cá»§a cÃ´ng nhÃ¢n, 34 cuá»™c biá»ƒu tÃ¬nh nÃ´ng dÃ¢n vÃ  4 cuá»™c Ä‘áº¥u tranh cá»§a nhÃ¢n dÃ¢n thÃ nh thá»‹.'},
  {q:'ÄoÃ n Ä‘áº¡i biá»ƒu Äáº£ng Cá»™ng sáº£n ÄÃ´ng DÆ°Æ¡ng táº¡i Äáº¡i há»™i VII QTCS gá»“m nhá»¯ng ai?',opts:['LÃª Há»“ng Phong, Nguyá»…n Thá»‹ Minh Khai, HoÃ ng VÄƒn Ná»n','Tráº§n PhÃº, HÃ  Huy Táº­p, LÃª Há»“ng Phong','Nguyá»…n Ãi Quá»‘c, LÃª Há»“ng Phong, Nguyá»…n VÄƒn Cá»«','HÃ  Huy Táº­p, PhÃ¹ng ChÃ­ KiÃªn, Nguyá»…n Thá»‹ Minh Khai'],ans:0,exp:'Ba Ä‘áº¡i biá»ƒu dá»± Äáº¡i há»™i VII (7/1935): LÃª Há»“ng Phong (Ä‘Æ°á»£c báº§u vÃ o BCH QTCS), Nguyá»…n Thá»‹ Minh Khai, HoÃ ng VÄƒn Ná»n.'},
  {q:'Cuá»™c váº­n Ä‘á»™ng dÃ¢n chá»§ 1936â€“1939 cÃ³ Ã½ nghÄ©a gÃ¬ vá»›i CÃ¡ch máº¡ng ThÃ¡ng TÃ¡m?',opts:['LÃ  bÆ°á»›c chuáº©n bá»‹ lá»±c lÆ°á»£ng cho tháº¯ng lá»£i 1945','LÃ  cuá»™c cÃ¡ch máº¡ng hoÃ n chá»‰nh','ÄÃ£ giáº£i phÃ³ng Ä‘Æ°á»£c ÄÃ´ng DÆ°Æ¡ng','KhÃ´ng cÃ³ liÃªn há»‡ vá»›i 1945'],ans:0,exp:'BOX 56 kháº³ng Ä‘á»‹nh: "Cuá»™c váº­n Ä‘á»™ng dÃ¢n chá»§ 1936â€“1939 lÃ m cho tráº­n Ä‘á»‹a vÃ  lá»±c lÆ°á»£ng cÃ¡ch máº¡ng Ä‘Æ°á»£c má»Ÿ rá»™ng, lÃ  bÆ°á»›c chuáº©n bá»‹ cho CÃ¡ch máº¡ng ThÃ¡ng TÃ¡m."'},
  {q:'Tá» bÃ¡o bÃ­ máº­t nÃ o Ä‘Æ°á»£c xuáº¥t báº£n táº¡i nhÃ  tÃ¹ Há»a LÃ²?',opts:['"Äuá»‘c Ä‘Æ°a Ä‘Æ°á»ng" vÃ  "Con Ä‘Æ°á»ng chÃ­nh"','"Ã kiáº¿n chung" vÃ  "Giáº£i phÃ³ng"','"NhÃ¢n dÃ¢n" vÃ  "Cá» Ä‘á»"','"Tranh Ä‘áº¥u" vÃ  "Tiáº¿n lÃªn"'],ans:0,exp:'Táº¡i Há»a LÃ² (HÃ  Ná»™i) cÃ³ hai tá» bÃ¡o bÃ­ máº­t: "Äuá»‘c Ä‘Æ°a Ä‘Æ°á»ng" vÃ  "Con Ä‘Æ°á»ng chÃ­nh" â€” phá»¥c vá»¥ há»c táº­p vÃ  Ä‘áº¥u tranh tÆ° tÆ°á»Ÿng.'},
];

// ============================================================
// PERIODS
// ============================================================
const PERIODS=[
  {id:'all',label:'ğŸ“š Táº¥t cáº£',prompt:'Báº¡n cÃ³ thá»ƒ tráº£ lá»i má»i cÃ¢u há»i vá» giai Ä‘oáº¡n 1929â€“1939.',welcome:'ChÃ o má»«ng báº¡n Ä‘áº¿n **Trung tÃ¢m Tháº£o luáº­n Lá»‹ch sá»­**!\nHá»i tÃ´i báº¥t cá»© Ä‘iá»u gÃ¬ vá» giai Ä‘oáº¡n **1929â€“1939** cá»§a lá»‹ch sá»­ cÃ¡ch máº¡ng Viá»‡t Nam!',quickPrompts:['TÃ³m táº¯t toÃ n bá»™ 1929â€“1939','NhÃ¢n váº­t quan trá»ng nháº¥t?','Nhá»¯ng bÆ°á»›c ngoáº·t lá»›n?','So sÃ¡nh giai Ä‘oáº¡n 1930â€“31 vÃ  1936â€“39']},
  {id:'khunghoang',label:'1929â€“1930',prompt:'Táº­p trung vÃ o khá»§ng hoáº£ng kinh táº¿ tháº¿ giá»›i 1929â€“1933, YÃªn BÃ¡i, bÃ£i cÃ´ng cÃ´ng nhÃ¢n, biá»ƒu tÃ¬nh nÃ´ng dÃ¢n, cao trÃ o 6â€“9/1930.',welcome:'## 1929â€“1930: Khá»§ng hoáº£ng & BÃ¹ng ná»•\n- ğŸŒ Khá»§ng hoáº£ng kinh táº¿ tÆ° báº£n 1929â€“1933\n- âš¡ PhÃ¡p tÄƒng cÆ°á»ng bÃ³c lá»™t ÄÃ´ng DÆ°Æ¡ng\n- ğŸ­ BÃ£i cÃ´ng liÃªn tiáº¿p (1â€“4/1930)\n- ğŸ”¥ 121 cuá»™c Ä‘áº¥u tranh (6â€“8/1930)',quickPrompts:['Khá»§ng hoáº£ng 1929 áº£nh hÆ°á»Ÿng tháº¿ nÃ o?','Phong trÃ o cÃ´ng nhÃ¢n 1930','Biá»ƒu tÃ¬nh HÆ°ng NguyÃªn 12/9/1930','XÃ´ viáº¿t Nghá»‡ TÄ©nh lÃ  gÃ¬?']},
  {id:'xoviet',label:'1930â€“1931',prompt:'Táº­p trung vÃ o Há»™i nghá»‹ TW I, Luáº­n cÆ°Æ¡ng Tráº§n PhÃº, Ä‘Ã n Ã¡p tráº¯ng, nhÃ  tÃ¹, LÃ½ Tá»± Trá»ng, Nguyá»…n Äá»©c Cáº£nh.',welcome:'## 1930â€“1931: XÃ´ viáº¿t & ÄÃ n Ã¡p\n- ğŸ› Há»™i nghá»‹ TW I: Ä‘á»•i tÃªn Äáº£ng, Tráº§n PhÃº lÃ m TBT\n- âœŠ "HÃ£y giá»¯ vá»¯ng chÃ­ khÃ­ chiáº¿n Ä‘áº¥u!" â€” Tráº§n PhÃº\n- âš¡ "Con Ä‘Æ°á»ng cá»§a thanh niÃªn..." â€” LÃ½ Tá»± Trá»ng\n- ğŸ« Chi bá»™ bÃ­ máº­t trong nhÃ  tÃ¹',quickPrompts:['Luáº­n cÆ°Æ¡ng 10/1930 lÃ  gÃ¬?','Tráº§n PhÃº â€“ cá»‘ng hiáº¿n lá»‹ch sá»­','Hoáº¡t Ä‘á»™ng trong nhÃ  tÃ¹','XÃ´ viáº¿t Nghá»‡ TÄ©nh sá»¥p Ä‘á»• tháº¿ nÃ o?']},
  {id:'phuchoi',label:'1932â€“1935',prompt:'Táº­p trung vÃ o LÃª Há»“ng Phong, ChÆ°Æ¡ng trÃ¬nh hÃ nh Ä‘á»™ng 1932, phá»¥c há»“i tá»• chá»©c, Äáº¡i há»™i I Ma Cao.',welcome:'## 1932â€“1935: Gian khá»• Phá»¥c há»“i\n- ğŸ“‹ ChÆ°Æ¡ng trÃ¬nh hÃ nh Ä‘á»™ng LÃª Há»“ng Phong (1932)\n- ğŸ“š HÃ  Huy Táº­p: SÆ¡ tháº£o lá»‹ch sá»­ (3/1933)\n- ğŸ¯ Äáº¡i há»™i Äáº£ng I â€“ Ma Cao (3/1935)\n- âš ï¸ Háº¡n cháº¿: chÆ°a Ä‘áº·t giáº£i phÃ³ng dÃ¢n tá»™c lÃªn Ä‘áº§u',quickPrompts:['Äáº¡i há»™i I cÃ³ gÃ¬ Ä‘áº·c biá»‡t?','Ba nhiá»‡m vá»¥ Äáº¡i há»™i I','Háº¡n cháº¿ cá»§a Äáº¡i há»™i I','LÃª Há»“ng Phong lÃ  ai?']},
  {id:'danchuvinh',label:'1936â€“1939',prompt:'Táº­p trung vÃ o Äáº¡i há»™i VII QTCS, Máº·t tráº­n DÃ¢n chá»§, chiáº¿n sÃ¡ch má»›i, Nguyá»…n VÄƒn Cá»«, Tá»± chá»‰ trÃ­ch.',welcome:'## 1936â€“1939: Phong trÃ o DÃ¢n chá»§\n- ğŸŒ Äáº¡i há»™i VII QTCS â€“ chá»‘ng phÃ¡t xÃ­t\n- ğŸ“° BÃ¡o chÃ­, sÃ¡ch chÃ­nh trá»‹ cÃ´ng khai\n- ğŸ¤ Máº·t tráº­n DÃ¢n chá»§ ÄÃ´ng DÆ°Æ¡ng (3/1938)\n- âœï¸ Tá»± chá»‰ trÃ­ch â€“ Nguyá»…n VÄƒn Cá»« (1939)',quickPrompts:['Táº¡i sao 1936â€“1939 lÃ  bÆ°á»›c ngoáº·t?','Máº·t tráº­n DÃ¢n chá»§ lÃ  gÃ¬?','Äiá»n Ä‘á»‹a vs pháº£n Ä‘áº¿ thay Ä‘á»•i tháº¿ nÃ o?','Nguyá»…n VÄƒn Cá»« vÃ  Tá»± chá»‰ trÃ­ch']},
];

const SYSTEM_BASE=`Báº¡n lÃ  chuyÃªn gia lá»‹ch sá»­ vá» Äáº£ng Cá»™ng sáº£n Viá»‡t Nam giai Ä‘oáº¡n 1929â€“1939. Tráº£ lá»i chÃ­nh xÃ¡c theo sá»± kiá»‡n lá»‹ch sá»­, hoÃ n toÃ n báº±ng tiáº¿ng Viá»‡t, cÃ³ cáº¥u trÃºc rÃµ rÃ ng. DÃ¹ng markdown: ## tiÃªu Ä‘á», **in Ä‘áº­m** cho sá»± kiá»‡n/má»‘c quan trá»ng, *in nghiÃªng* cho trÃ­ch dáº«n, > blockquote cho cÃ¢u nÃ³i ná»•i tiáº¿ng. Cuá»‘i má»—i cÃ¢u tráº£ lá»i gá»£i má»Ÿ 1â€“2 cÃ¢u há»i liÃªn quan.`;

// ============================================================
// BOX DATA
// ============================================================
const BOXES_DATA=[
  {id:1,era:'1929â€“1930 Â· Bá»‘i cáº£nh Tháº¿ giá»›i',content:'Trong thá»i gian 1929â€“1933, khi LiÃªn XÃ´ Ä‘ang Ä‘áº¡t Ä‘Æ°á»£c nhá»¯ng thÃ nh quáº£ quan trá»ng trong cÃ´ng cuá»™c xÃ¢y dá»±ng Ä‘áº¥t nÆ°á»›c, thÃ¬ á»Ÿ cÃ¡c nÆ°á»›c tÆ° báº£n chá»§ nghÄ©a diá»…n ra má»™t cuá»™c khá»§ng hoáº£ng kinh táº¿ trÃªn quy mÃ´ lá»›n, Ä‘á»ƒ láº¡i nhá»¯ng háº­u quáº£ náº·ng ná», lÃ m cho nhá»¯ng mÃ¢u thuáº«n trong lÃ²ng xÃ£ há»™i tÆ° báº£n phÃ¡t triá»ƒn gay gáº¯t. Phong trÃ o cÃ¡ch máº¡ng tháº¿ giá»›i dÃ¢ng cao.'},
  {id:2,era:'1930 Â· ÄÃ´ng DÆ°Æ¡ng',content:'á» ÄÃ´ng DÆ°Æ¡ng, thá»±c dÃ¢n PhÃ¡p tÄƒng cÆ°á»ng bÃ³c lá»™t Ä‘á»ƒ bÃ¹ Ä‘áº¯p nhá»¯ng háº­u quáº£ cá»§a cuá»™c khá»§ng hoáº£ng kinh táº¿ quá»‘c, Ä‘á»“ng thá»i tiáº¿n hÃ nh má»™t chiáº¿n dá»‹ch khá»§ng bá»‘ tráº¯ng nháº±m Ä‘Ã n Ã¡p cuá»™c khá»Ÿi nghÄ©a YÃªn BÃ¡i (2/1930). MÃ¢u thuáº«n giá»¯a dÃ¢n tá»™c Viá»‡t Nam vá»›i Ä‘áº¿ quá»‘c PhÃ¡p vÃ  tay sai cÃ ng trá»Ÿ nÃªn gay gáº¯t.'},
  {id:3,era:'1â€“4/1930 Â· BÃ£i cÃ´ng & Biá»ƒu tÃ¬nh',content:'Tá»« thÃ¡ng 1 Ä‘áº¿n thÃ¡ng 4/1930, bÃ£i cÃ´ng cá»§a cÃ´ng nhÃ¢n ná»• ra liÃªn tiáº¿p á»Ÿ nhÃ  mÃ¡y xi mÄƒng Háº£i PhÃ²ng, hÃ£ng dáº§u NhÃ  BÃ¨ (SÃ i GÃ²n), cÃ¡c Ä‘á»“n Ä‘iá»n PhÃº Riá»ng, Dáº§u Tiáº¿ng, nhÃ  mÃ¡y dá»‡t Nam Äá»‹nh, nhÃ  mÃ¡y diÃªm vÃ  nhÃ  mÃ¡y cÆ°a Báº¿n Thá»§yâ€¦ Phong trÃ o Ä‘áº¥u tranh cá»§a nÃ´ng dÃ¢n cÅ©ng diá»…n ra á»Ÿ nhiá»u Ä‘á»‹a phÆ°Æ¡ng nhÆ° HÃ  Nam, ThÃ¡i BÃ¬nh, Nghá»‡ An, HÃ  TÄ©nhâ€¦ Truyá»n Ä‘Æ¡n, cá» Ä‘á» bÃºa liá»m xuáº¥t hiá»‡n trÃªn cÃ¡c Ä‘Æ°á»ng phá»‘ HÃ  Ná»™i vÃ  nhiá»u Ä‘á»‹a phÆ°Æ¡ng.'},
  {id:4,era:'5/1930 Â· Quá»‘c táº¿ Lao Ä‘á»™ng',content:'5/1930, nhÃ¢n dÃ¢n Viá»‡t Nam ká»· niá»‡m NgÃ y Quá»‘c táº¿ Lao Ä‘á»™ng vá»›i nhá»¯ng hÃ¬nh thá»©c Ä‘áº¥u tranh phong phÃº. Ná»• ra 16 cuá»™c bÃ£i cÃ´ng cá»§a cÃ´ng nhÃ¢n, 34 cuá»™c biá»ƒu tÃ¬nh cá»§a nÃ´ng dÃ¢n vÃ  4 cuá»™c Ä‘áº¥u tranh cá»§a cÃ¡c táº§ng lá»›p nhÃ¢n dÃ¢n thÃ nh thá»‹.'},
  {id:5,era:'6â€“8/1930 Â· Leo thang Äáº¥u tranh',content:'Tá»« thÃ¡ng 6 Ä‘áº¿n thÃ¡ng 8/1930 Ä‘Ã£ ná»• ra 121 cuá»™c Ä‘áº¥u tranh, ná»•i báº­t nháº¥t lÃ  cuá»™c tá»•ng bÃ£i cÃ´ng cá»§a cÃ´ng nhÃ¢n khu cÃ´ng nghiá»‡p Báº¿n Thá»§y â€“ Vinh (8/1930), Ä‘Ã¡nh dáº¥u má»™t thá»i ká»³ má»›i, thá»i ká»³ Ä‘áº¥u tranh ká»‹ch liá»‡t Ä‘Ã£ Ä‘áº¿n.'},
  {id:6,era:'9/1930 Â· Äá»‰nh cao Phong trÃ o',content:'9/1930, phong trÃ o cÃ¡ch máº¡ng phÃ¡t triá»ƒn Ä‘áº¿n Ä‘á»‰nh cao. Cuá»™c biá»ƒu tÃ¬nh cá»§a nÃ´ng dÃ¢n HÆ°ng NguyÃªn, ngÃ y 12/9/1930 bá»‹ Ä‘Ã n Ã¡p dá»¯ dá»™i, mÃ¡y bay PhÃ¡p nÃ©m bom giáº¿t cháº¿t 171 ngÆ°á»i. NhÆ° lá»­a Ä‘á»• thÃªm dáº§u, phong trÃ o cÃ¡ch máº¡ng bÃ¹ng lÃªn máº¡nh máº½.'},
  {id:7,era:'9/1930 Â· Chá»‰ Ä‘áº¡o cá»§a Äáº£ng',content:'ThÃ¡ng 9/1930, Ban ThÆ°á»ng vá»¥ TW Äáº£ng gá»­i ThÃ´ng tri cho Xá»© á»§y Trung Ká»³ váº¡ch rÃµ chá»§ trÆ°Æ¡ng báº¡o Ä‘á»™ng riÃªng láº» lÃ  quÃ¡ sá»›m. TrÃ¡ch nhiá»‡m cá»§a Äáº£ng lÃ  tá»• chá»©c quáº§n chÃºng chá»‘ng khá»§ng bá»‘, giá»¯ vá»¯ng lá»±c lÆ°á»£ng cÃ¡ch máº¡ng.'},
  {id:8,era:'Cuá»‘i 1930 Â· Khá»§ng bá»‘ Tráº¯ng',content:'Tá»« cuá»‘i nÄƒm 1930, thá»±c dÃ¢n PhÃ¡p táº­p trung má»i lá»±c lÆ°á»£ng Ä‘Ã n Ã¡p khá»‘c liá»‡t, káº¿t há»£p thá»§ Ä‘oáº¡n báº¡o lá»±c vá»›i nhá»¯ng thá»§ Ä‘oáº¡n chÃ­nh trá»‹ nhÆ° cÆ°á»¡ng bá»©c dÃ¢n cÃ y ra Ä‘áº§u thÃº, tá»• chá»©c rÆ°á»›c cá» vÃ ng, nháº­n tháº» quy thuáº­n.'},
  {id:9,era:'Äáº§u 1931 Â· Tá»•n tháº¥t náº·ng ná»',content:'Äáº§u nÄƒm 1931, hÃ ng nghÃ¬n chiáº¿n sÄ© cá»™ng sáº£n, hÃ ng váº¡n ngÆ°á»i yÃªu nÆ°á»›c bá»‹ báº¯t, bá»‹ giáº¿t hoáº·c bá»‹ tÃ¹ Ä‘Ã y.'},
  {id:10,era:'4/1931 Â· TW Äáº£ng tan vá»¡',content:'4/1931, toÃ n bá»™ Ban Cháº¥p hÃ nh Trung Æ°Æ¡ng Äáº£ng bá»‹ báº¯t, khÃ´ng cÃ²n láº¡i má»™t á»§y viÃªn nÃ o. "CÃ¡c tá»• chá»©c cá»§a Äáº£ng vÃ  cá»§a quáº§n chÃºng tan rÃ£ háº§u háº¿t".'},
  {id:11,era:'10/1930 Â· Há»™i nghá»‹ TW láº§n I',content:'Tá»« ngÃ y 14 Ä‘áº¿n ngÃ y 31/10/1930, Ban Cháº¥p hÃ nh TW há»p Há»™i nghá»‹ láº§n thá»© nháº¥t táº¡i HÆ°Æ¡ng Cáº£ng (Há»“ng KÃ´ng), quyáº¿t Ä‘á»‹nh Ä‘á»•i tÃªn Äáº£ng Cá»™ng sáº£n Viá»‡t Nam thÃ nh Äáº£ng Cá»™ng sáº£n ÄÃ´ng DÆ°Æ¡ng. Äá»“ng chÃ­ Tráº§n PhÃº Ä‘Æ°á»£c báº§u lÃ m Tá»•ng BÃ­ thÆ°.'},
  {id:12,era:'10/1930 Â· Luáº­n cÆ°Æ¡ng ChÃ­nh trá»‹',content:'Luáº­n cÆ°Æ¡ng chÃ­nh trá»‹ thÃ¡ng 10/1930 Ä‘Ã£ xÃ¡c Ä‘á»‹nh nhiá»u váº¥n Ä‘á» cÆ¡ báº£n vá» chiáº¿n lÆ°á»£c cÃ¡ch máº¡ng, vá» cÆ¡ báº£n thá»‘ng nháº¥t vá»›i ná»™i dung cá»§a ChÃ­nh cÆ°Æ¡ng, sÃ¡ch lÆ°á»£c váº¯n táº¯t cá»§a Há»™i nghá»‹ thÃ nh láº­p Äáº£ng thÃ¡ng 2/1930.'},
  {id:13,era:'11/1930 Â· Há»™i Pháº£n Ä‘áº¿ Äá»“ng minh',content:'NgÃ y 18/11/1930, ThÆ°á»ng vá»¥ TW Äáº£ng ban hÃ nh Chá»‰ thá»‹ vá» viá»‡c thÃ nh láº­p Há»™i Pháº£n Ä‘áº¿ Äá»“ng minh â€” tá»• chá»©c máº·t tráº­n Ä‘áº§u tiÃªn Ä‘á»ƒ táº­p há»£p, Ä‘oÃ n káº¿t cÃ¡c giai cáº¥p, táº§ng lá»›p dÃ¢n tá»™c.'},
  {id:14,era:'1931 Â· Giai Ä‘oáº¡n Gian khá»•',content:'Do bá»‹ tá»•n tháº¥t náº·ng ná», cÃ¡ch máº¡ng Viá»‡t Nam bÆ°á»›c vÃ o giai Ä‘oáº¡n Ä‘áº¥u tranh cá»±c ká»³ gian khá»•. ThÃ¡ng 1/1931, TW Äáº£ng ra ThÃ´ng cÃ¡o váº¡ch rÃµ thá»§ Ä‘oáº¡n káº» thÃ¹ vÃ  hÆ°á»›ng dáº«n quáº§n chÃºng Ä‘áº¥u tranh. Tráº§n PhÃº bá»‹ báº¯t ngÃ y 18/4/1931 táº¡i SÃ i GÃ²n.'},
  {id:15,era:'5/1931 Â· Chá»‰nh Ä‘á»‘n Äáº£ng',content:'Xá»© á»§y Trung Ká»³ ra chá»§ trÆ°Æ¡ng "thanh trá»« trÃ­, phÃº, Ä‘á»‹a, hÃ o, Ä‘Ã o táº­n gá»‘c, trá»‘c táº­n rá»…". ThÃ¡ng 5/1931, TW Äáº£ng phÃª phÃ¡n sai láº§m nÃ y vÃ  váº¡ch ra phÆ°Æ¡ng hÆ°á»›ng xÃ¢y dá»±ng Äáº£ng, "lÃ m cho Äáº£ng Bolshevik hÃ³a Ä‘á»ƒ cÃ¡ch máº¡ng hÃ³a quáº§n chÃºng".'},
  {id:16,era:'11/4/1931 Â· Quá»‘c táº¿ CÃ´ng nháº­n',content:'11/4/1931, Quá»‘c táº¿ Cá»™ng sáº£n ra Nghá»‹ quyáº¿t cÃ´ng nháº­n Äáº£ng Cá»™ng sáº£n ÄÃ´ng DÆ°Æ¡ng lÃ  chi bá»™ Ä‘á»™c láº­p â€” kháº³ng Ä‘á»‹nh vai trÃ² lÃ£nh Ä‘áº¡o cá»§a Äáº£ng.'},
  {id:17,era:'6/9/1931 Â· Tráº§n PhÃº Hy sinh',content:'Tá»•ng BÃ­ thÆ° Tráº§n PhÃº hy sinh ngÃ y 6/9/1931 táº¡i NhÃ  thÆ°Æ¡ng Chá»£ QuÃ¡n (SÃ i GÃ²n), trÆ°á»›c lÃºc hy sinh cÄƒn dáº·n: "HÃ£y giá»¯ vá»¯ng chÃ­ khÃ­ chiáº¿n Ä‘áº¥u!".'},
  {id:18,era:'1931 Â· Táº¥m gÆ°Æ¡ng Chiáº¿n sÄ©',content:'Náº±m trong xÃ  lim Ã¡n chÃ©m, Nguyá»…n Äá»©c Cáº£nh váº«n viáº¿t tá»•ng káº¿t cÃ´ng tÃ¡c váº­n Ä‘á»™ng cÃ´ng nhÃ¢n. LÃ½ Tá»± Trá»ng trÆ°á»›c lÃºc hy sinh nÃ³i: "Con Ä‘Æ°á»ng cá»§a thanh niÃªn chá»‰ cÃ³ thá»ƒ lÃ  con Ä‘Æ°á»ng cÃ¡ch máº¡ng".'},
  {id:19,era:'1931 Â· Äáº¥u tranh trong TÃ¹',content:'CÃ¡c Ä‘áº£ng viÃªn trong nhÃ  tÃ¹ Há»a LÃ², KhÃ¡m Lá»›n, Vinh, Háº£i PhÃ²ng, CÃ´n Äáº£o... bÃ­ máº­t thÃ nh láº­p nhiá»u chi bá»™ Ä‘á»ƒ lÃ£nh Ä‘áº¡o Ä‘áº¥u tranh chá»‘ng cháº¿ Ä‘á»™ nhÃ  tÃ¹ hÃ  kháº¯c. Anh chá»‹ em tÃ¹ Há»a LÃ² tuyá»‡t thá»±c pháº£n Ä‘á»‘i vá»¥ Ã¡n tá»­ hÃ¬nh Nguyá»…n Äá»©c Cáº£nh.'},
  {id:20,era:'1931â€“1932 Â· TrÆ°á»ng há»c CÃ¡ch máº¡ng',content:'Nhiá»u chi bá»™ nhÃ  tÃ¹ tá»• chá»©c huáº¥n luyá»‡n Ä‘áº£ng viÃªn vá» lÃ½ luáº­n MÃ¡câ€“LÃªnin, Ä‘Æ°á»ng lá»‘i chÃ­nh trá»‹ cá»§a Äáº£ng, kinh nghiá»‡m váº­n Ä‘á»™ng cÃ¡ch máº¡ng; tá»• chá»©c há»c vÄƒn hÃ³a, ngoáº¡i ngá»¯.'},
  {id:21,era:'1931â€“1932 Â· TÃ i liá»‡u trong TÃ¹',content:'Nhiá»u tÃ i liá»‡u huáº¥n luyá»‡n Ä‘Æ°á»£c biÃªn soáº¡n trong tÃ¹. BÃ¡o bÃ­ máº­t: "Äuá»‘c Ä‘Æ°a Ä‘Æ°á»ng" vÃ  "Con Ä‘Æ°á»ng chÃ­nh" (Há»a LÃ²); "Ã kiáº¿n chung" (CÃ´n Äáº£o). CÃ¡c tÃ¡c pháº©m MÃ¡câ€“LÃªnin Ä‘Æ°á»£c dá»‹ch ra tiáº¿ng Viá»‡t.'},
  {id:22,era:'6/6/1931 Â· Nguyá»…n Ãi Quá»‘c bá»‹ báº¯t',content:'6/6/1931, lÃ£nh tá»¥ Nguyá»…n Ãi Quá»‘c bá»‹ chÃ­nh quyá»n Anh á»Ÿ Há»“ng KÃ´ng báº¯t giam.'},
  {id:23,era:'Äáº§u 1934 Â· Nguyá»…n Ãi Quá»‘c',content:'Äáº§u nÄƒm 1934, sau khi ra tÃ¹, NgÆ°á»i trá»Ÿ láº¡i lÃ m viá»‡c á»Ÿ Quá»‘c táº¿ Cá»™ng sáº£n (MÃ¡txcÆ¡va â€“ LiÃªn XÃ´).'},
  {id:24,era:'Äáº§u 1932 Â· ChÆ°Æ¡ng trÃ¬nh HÃ nh Ä‘á»™ng',content:'Äáº§u nÄƒm 1932, LÃª Há»“ng Phong cÃ¹ng má»™t sá»‘ Ä‘á»“ng chÃ­ cÃ´ng bá»‘ ChÆ°Æ¡ng trÃ¬nh hÃ nh Ä‘á»™ng cá»§a Äáº£ng Cá»™ng sáº£n ÄÃ´ng DÆ°Æ¡ng vÃ  cÃ¡c chÆ°Æ¡ng trÃ¬nh cá»§a CÃ´ng há»™i, NÃ´ng há»™i, Thanh niÃªn Cá»™ng sáº£n Ä‘oÃ n.'},
  {id:25,era:'15/6/1932 Â· KhÃ´i phá»¥c Tá»• chá»©c',content:'ChÆ°Æ¡ng trÃ¬nh hÃ nh Ä‘á»™ng (15/6/1932) váº¡ch ra nhiá»‡m vá»¥ khÃ´i phá»¥c tá»• chá»©c Äáº£ng, cáº§n "gÃ¢y dá»±ng má»™t Ä‘oÃ n thá»ƒ bÃ­ máº­t, cÃ³ ká»· luáº­t nghiÃªm ngáº·t, vá»¯ng nhÆ° sáº¯t Ä‘á»“ng, tá»©c Äáº£ng Cá»™ng sáº£n Ä‘á»ƒ hÆ°á»›ng Ä‘áº¡o quáº§n chÃºng".'},
  {id:26,era:'3/1933 Â· SÆ¡ tháº£o Lá»‹ch sá»­',content:'3/1933, HÃ  Huy Táº­p viáº¿t SÆ¡ tháº£o lá»‹ch sá»­ phong trÃ o cá»™ng sáº£n ÄÃ´ng DÆ°Æ¡ng, bÆ°á»›c Ä‘áº§u tá»•ng káº¿t kinh nghiá»‡m lÃ£nh Ä‘áº¡o cá»§a Äáº£ng, kháº³ng Ä‘á»‹nh cÃ´ng lao cá»§a Nguyá»…n Ãi Quá»‘c.'},
  {id:27,era:'5/1933 Â· PhiÃªn tÃ²a Äáº¡i hÃ¬nh',content:'Tá»« 2â€“9/5/1933, TÃ²a Ã¡n Äáº¡i hÃ¬nh SÃ i GÃ²n xÃ©t xá»­ 120 chiáº¿n sÄ© cá»™ng sáº£n vÃ  Ä‘Ã y ra CÃ´n Äáº£o, trong Ä‘Ã³ cÃ³ NgÃ´ Gia Tá»±, Nguyá»…n ChÃ­ Diá»ƒu, LÃª VÄƒn LÆ°Æ¡ng, Pháº¡m HÃ¹ng, BÃ¹i LÃ¢m.'},
  {id:28,era:'Äáº§u 1934 Â· Ban Chá»‰ huy á»Ÿ ngoÃ i',content:'Äáº§u nÄƒm 1934, theo chá»‰ Ä‘áº¡o cá»§a Quá»‘c táº¿ Cá»™ng sáº£n, Ban Chá»‰ huy á»Ÿ ngoÃ i cá»§a Äáº£ng Cá»™ng sáº£n ÄÃ´ng DÆ°Æ¡ng Ä‘Æ°á»£c thÃ nh láº­p Ä‘á»ƒ lÃ£nh Ä‘áº¡o phong trÃ o trong nÆ°á»›c.'},
  {id:29,era:'Äáº§u 1935 Â· Tá»• chá»©c Phá»¥c há»“i',content:'Äáº§u nÄƒm 1935, há»‡ thá»‘ng tá»• chá»©c cá»§a Äáº£ng Ä‘Æ°á»£c phá»¥c há»“i, táº¡o cÆ¡ sá»Ÿ Ä‘á»ƒ tiáº¿n tá»›i Äáº¡i há»™i Ä‘áº¡i biá»ƒu láº§n thá»© I.'},
  {id:30,era:'3/1935 Â· Äáº¡i há»™i Äáº£ng I',content:'ThÃ¡ng 3/1935, Äáº¡i há»™i Ä‘áº¡i biá»ƒu láº§n thá»© I há»p á»Ÿ Ma Cao (Trung Quá»‘c), Ä‘á» ra 3 nhiá»‡m vá»¥: 1) Cá»§ng cá»‘ vÃ  phÃ¡t triá»ƒn Äáº£ng; 2) Váº­n Ä‘á»™ng táº­p há»£p quáº§n chÃºng; 3) TuyÃªn truyá»n chá»‘ng Ä‘áº¿ quá»‘c, chá»‘ng chiáº¿n tranh, á»§ng há»™ LiÃªn XÃ´.'},
  {id:31,era:'3/1935 Â· LÃª Há»“ng Phong â€“ TBT',content:'Äáº¡i há»™i báº§u LÃª Há»“ng Phong lÃ m Tá»•ng BÃ­ thÆ°, báº§u Ä‘oÃ n Ä‘áº¡i biá»ƒu dá»± Äáº¡i há»™i VII Quá»‘c táº¿ Cá»™ng sáº£n. Nguyá»…n Ãi Quá»‘c Ä‘Æ°á»£c cá»­ lÃ m Ä‘áº¡i diá»‡n Äáº£ng bÃªn cáº¡nh Quá»‘c táº¿ Cá»™ng sáº£n.'},
  {id:32,era:'3/1935 Â· Háº¡n cháº¿ Äáº¡i há»™i I',content:'Äáº¡i há»™i I (3/1935) chÆ°a Ä‘á» ra chiáº¿n lÆ°á»£c phÃ¹ há»£p, chÆ°a Ä‘áº·t nhiá»‡m vá»¥ giáº£i phÃ³ng dÃ¢n tá»™c lÃªn hÃ ng Ä‘áº§u. "ChÃ­nh sÃ¡ch Äáº¡i há»™i Ma Cao váº¡ch ra khÃ´ng sÃ¡t vá»›i phong trÃ o cÃ¡ch máº¡ng tháº¿ giá»›i vÃ  trong nÆ°á»›c lÃºc báº¥y giá»".'},
  {id:33,era:'3/1935 Â· Ã nghÄ©a Äáº¡i há»™i I',content:'Äáº¡i há»™i I Ä‘Ã¡nh dáº¥u sá»± phá»¥c há»“i há»‡ thá»‘ng tá»• chá»©c cá»§a Äáº£ng vÃ  phong trÃ o cÃ¡ch máº¡ng quáº§n chÃºng, táº¡o Ä‘iá»u kiá»‡n Ä‘á»ƒ bÆ°á»›c vÃ o cao trÃ o cÃ¡ch máº¡ng má»›i.'},
  {id:34,era:'1933â€“1935 Â· Nguy cÆ¡ PhÃ¡t xÃ­t',content:'Chá»§ nghÄ©a phÃ¡t xÃ­t xuáº¥t hiá»‡n vÃ  táº¡m thá»i tháº¯ng tháº¿ á»Ÿ Äá»©c, Italia, TÃ¢y Ban Nha. Nguy cÆ¡ chiáº¿n tranh tháº¿ giá»›i Ä‘e dá»a nghiÃªm trá»ng ná»n hÃ²a bÃ¬nh vÃ  an ninh quá»‘c táº¿.'},
  {id:35,era:'7/1935 Â· Äáº¡i há»™i VII QTCS',content:'7/1935, Quá»‘c táº¿ Cá»™ng sáº£n há»p Äáº¡i há»™i VII táº¡i MÃ¡txcÆ¡va, xÃ¡c Ä‘á»‹nh chá»§ nghÄ©a phÃ¡t xÃ­t lÃ  káº» thÃ¹ nguy hiá»ƒm nháº¥t. Nhiá»‡m vá»¥: chá»‘ng phÃ¡t xÃ­t, chá»‘ng chiáº¿n tranh, báº£o vá»‡ dÃ¢n chá»§ vÃ  hÃ²a bÃ¬nh.'},
  {id:36,era:'7/1935 Â· ÄoÃ n Ä‘áº¡i biá»ƒu ÄÃ´ng DÆ°Æ¡ng',content:'ÄoÃ n Ä‘áº¡i biá»ƒu Äáº£ng Cá»™ng sáº£n ÄÃ´ng DÆ°Æ¡ng dá»± Äáº¡i há»™i VII: LÃª Há»“ng Phong, Nguyá»…n Thá»‹ Minh Khai, HoÃ ng VÄƒn Ná»n. LÃª Há»“ng Phong Ä‘Æ°á»£c báº§u vÃ o Ban Cháº¥p hÃ nh Quá»‘c táº¿ Cá»™ng sáº£n.'},
  {id:37,era:'1936 Â· Máº·t tráº­n NhÃ¢n dÃ¢n PhÃ¡p',content:'Máº·t tráº­n NhÃ¢n dÃ¢n PhÃ¡p (do Äáº£ng Cá»™ng sáº£n PhÃ¡p lÃ m nÃ²ng cá»‘t) tháº¯ng lá»£i trong tá»•ng tuyá»ƒn cá»­ 1936, dáº«n Ä‘áº¿n sá»± ra Ä‘á»i cá»§a ChÃ­nh phá»§ Máº·t tráº­n NhÃ¢n dÃ¢n PhÃ¡p.'},
  {id:38,era:'1936 Â· Äiá»u kiá»‡n Thuáº­n lá»£i',content:'á» Viá»‡t Nam, má»i táº§ng lá»›p xÃ£ há»™i Ä‘á»u mong muá»‘n cáº£i cÃ¡ch dÃ¢n chá»§. Äáº£ng tranh thá»§ cÆ¡ há»™i thuáº­n lá»£i Ä‘á»ƒ xÃ¢y dá»±ng, phÃ¡t triá»ƒn tá»• chá»©c Ä‘áº£ng vÃ  cÃ¡c tá»• chá»©c quáº§n chÃºng rá»™ng rÃ£i.'},
  {id:39,era:'26/7/1936 Â· Há»™i nghá»‹ ThÆ°á»£ng Háº£i',content:'NgÃ y 26/7/1936, BCH TW Äáº£ng há»p táº¡i ThÆ°á»£ng Háº£i, do LÃª Há»“ng Phong chá»§ trÃ¬, nháº±m "sá»­a chá»¯a nhá»¯ng sai láº§m" trÆ°á»›c Ä‘Ã³ vÃ  "Ä‘á»‹nh láº¡i chÃ­nh sÃ¡ch má»›i" theo nghá»‹ quyáº¿t Äáº¡i há»™i VII Quá»‘c táº¿ Cá»™ng sáº£n.'},
  {id:40,era:'8/1936â€“3/1938 Â· HÃ  Huy Táº­p TBT',content:'Äá»“ng chÃ­ HÃ  Huy Táº­p lÃ  Tá»•ng BÃ­ thÆ° cá»§a Äáº£ng tá»« thÃ¡ng 8/1936 Ä‘áº¿n thÃ¡ng 3/1938.'},
  {id:41,era:'3â€“9/1937 Â· Há»™i nghá»‹ TW III & IV',content:'CÃ¡c Há»™i nghá»‹ TW láº§n III (3/1937) vÃ  IV (9/1937) bÃ n sÃ¢u vá» tá»• chá»©c, quyáº¿t Ä‘á»‹nh táº­p há»£p quáº§n chÃºng trong máº·t tráº­n chá»‘ng pháº£n Ä‘á»™ng thuá»™c Ä‘á»‹a, Ä‘Ã²i tá»± do, dÃ¢n chá»§, cÆ¡m Ã¡o, hÃ²a bÃ¬nh.'},
  {id:42,era:'1936 Â· Pháº£n Ä‘áº¿ vs Äiá»n Ä‘á»‹a',content:'Chá»‰ thá»‹ 26/7/1936 chá»‰ rÃµ: "á»Ÿ xá»© thuá»™c Ä‘á»‹a nhÆ° ÄÃ´ng DÆ°Æ¡ng, náº¿u chá»‰ quan tÃ¢m Ä‘áº¿n Ä‘áº¥u tranh giai cáº¥p cÃ³ thá»ƒ gÃ¢y khÃ³ khÄƒn cho phong trÃ o giáº£i phÃ³ng dÃ¢n tá»™c".'},
  {id:43,era:'10/1936 Â· Chiáº¿n sÃ¡ch Má»›i',content:'VÄƒn kiá»‡n "Chung quanh váº¥n Ä‘á» chiáº¿n sÃ¡ch má»›i" (10/1936): "Cuá»™c dÃ¢n tá»™c giáº£i phÃ³ng khÃ´ng nháº¥t Ä‘á»‹nh pháº£i káº¿t cháº·t vá»›i Ä‘iá»n Ä‘á»‹a... pháº£i chá»n Ä‘á»‹ch nhÃ¢n chÃ­nh, nguy hiá»ƒm nháº¥t, Ä‘á»ƒ táº­p trung lá»±c lÆ°á»£ng Ä‘Ã¡nh cho Ä‘Æ°á»£c toÃ n tháº¯ng".'},
  {id:44,era:'1936â€“1939 Â· Váº­n Ä‘á»™ng DÃ¢n chá»§',content:'DÆ°á»›i sá»± lÃ£nh Ä‘áº¡o cá»§a Äáº£ng, cuá»™c váº­n Ä‘á»™ng dÃ¢n chá»§ diá»…n ra trÃªn quy mÃ´ rá»™ng lá»›n, lÃ´i cuá»‘n Ä‘Ã´ng Ä‘áº£o quáº§n chÃºng tham gia vá»›i nhá»¯ng hÃ¬nh thá»©c Ä‘áº¥u tranh phong phÃº.'},
  {id:45,era:'1936 Â· á»¦y ban HÃ nh Ä‘á»™ng',content:'Äáº£ng phÃ¡t Ä‘á»™ng váº­n Ä‘á»™ng láº­p "á»¦y ban trÃ¹ bá»‹ ÄÃ´ng DÆ°Æ¡ng Ä‘áº¡i há»™i". Trong thá»i gian ngáº¯n, cÃ¡c "á»§y ban hÃ nh Ä‘á»™ng" Ä‘Æ°á»£c láº­p kháº¯p nÆ¡i. RiÃªng Nam Ká»³ cÃ³ 600 "á»§y ban hÃ nh Ä‘á»™ng".'},
  {id:46,era:'Äáº§u 1937 Â· ÄÃ³n tiáº¿p Godart',content:'Äáº§u 1937, nhÃ¢n dá»‹p phÃ¡i viÃªn Godart Ä‘i kinh lÃ½ vÃ  BrÃ©viÃ© sang nháº­n chá»©c toÃ n quyá»n, Äáº£ng váº­n Ä‘á»™ng hai cuá»™c biá»ƒu dÆ°Æ¡ng lá»±c lÆ°á»£ng quáº§n chÃºng dÆ°á»›i danh nghÄ©a "Ä‘Ã³n rÆ°á»›c", mÃ­t tinh, biá»ƒu tÃ¬nh.'},
  {id:47,era:'5/6/1937 Â· HÃ  Huy Táº­p â€“ TÆ° tÆ°á»Ÿng',content:'NgÃ y 5/6/1937, HÃ  Huy Táº­p xuáº¥t báº£n "Tá»rá»‘txky vÃ  pháº£n cÃ¡ch máº¡ng", phÃª phÃ¡n luáº­n Ä‘iá»‡u "táº£ khuynh" cá»§a cÃ¡c pháº§n tá»­ trá»‘txkÃ­t nhÆ° Táº¡ Thu ThÃ¢u, gÃ³p pháº§n xÃ¢y dá»±ng Äáº£ng vá» tÆ° tÆ°á»Ÿng.'},
  {id:48,era:'1936â€“1939 Â· BÃ¡o chÃ­ CÃ´ng khai',content:'CÃ¡c bÃ¡o chÃ­ tiáº¿ng Viá»‡t vÃ  tiáº¿ng PhÃ¡p cá»§a Äáº£ng, Máº·t tráº­n DÃ¢n chá»§ ÄÃ´ng DÆ°Æ¡ng ra Ä‘á»i. Nhiá»u sÃ¡ch chÃ­nh trá»‹ phá»• thÃ´ng Ä‘Æ°á»£c xuáº¥t báº£n Ä‘á»ƒ giá»›i thiá»‡u chá»§ nghÄ©a MÃ¡câ€“LÃªnin vÃ  chÃ­nh sÃ¡ch má»›i cá»§a Äáº£ng.'},
  {id:49,era:'Cuá»‘i 1937 Â· Truyá»n bÃ¡ Quá»‘c ngá»¯',content:'Tá»« cuá»‘i nÄƒm 1937, phong trÃ o truyá»n bÃ¡ quá»‘c ngá»¯ phÃ¡t triá»ƒn máº¡nh.'},
  {id:50,era:'29â€“30/3/1938 Â· Máº·t tráº­n DÃ¢n chá»§',content:'Há»™i nghá»‹ TW (29â€“30/3/1938) quyáº¿t Ä‘á»‹nh láº­p Máº·t tráº­n DÃ¢n chá»§ ÄÃ´ng DÆ°Æ¡ng, báº§u Ä‘á»“ng chÃ­ Nguyá»…n VÄƒn Cá»« lÃ m Tá»•ng BÃ­ thÆ° cá»§a Äáº£ng.'},
  {id:51,era:'1937â€“1938 Â· Tranh cá»­ DÃ¢n biá»ƒu',content:'Máº·t tráº­n DÃ¢n chá»§ tá»• chá»©c váº­n Ä‘á»™ng tranh cá»­ vÃ o cÃ¡c Viá»‡n dÃ¢n biá»ƒu Báº¯c Ká»³, Trung Ká»³, Há»™i Ä‘á»“ng quáº£n háº¡t Nam Ká»³, Há»™i Ä‘á»“ng kinh táº¿ lÃ½ tÃ i ÄÃ´ng DÆ°Æ¡ng.'},
  {id:52,era:'1939 Â· Tá»± Chá»‰ TrÃ­ch',content:'NÄƒm 1939, Tá»•ng BÃ­ thÆ° Nguyá»…n VÄƒn Cá»« xuáº¥t báº£n "Tá»± chá»‰ trÃ­ch", tháº³ng tháº¯n chá»‰ rÃµ nhá»¯ng sai láº§m, khuyáº¿t Ä‘iá»ƒm vÃ  bÃ i há»c cáº§n thiáº¿t trong lÃ£nh Ä‘áº¡o cá»§a Äáº£ng.'},
  {id:53,era:'10/1938 Â· Nguyá»…n Ãi Quá»‘c vá» TQ',content:'ThÃ¡ng 10/1938, Nguyá»…n Ãi Quá»‘c rá»i MÃ¡txcÆ¡va trá»Ÿ láº¡i Trung Quá»‘c. NÄƒm 1939, tá»« Trung Quá»‘c, NgÆ°á»i gá»­i nhiá»u thÆ° cho TW Äáº£ng, truyá»n Ä‘áº¡t quan Ä‘iá»ƒm Quá»‘c táº¿ Cá»™ng sáº£n vÃ  gÃ³p Ã½ quan trá»ng.'},
  {id:54,era:'9/1939 Â· Chiáº¿n tranh TG2',content:'Chiáº¿n tranh tháº¿ giá»›i thá»© hai bÃ¹ng ná»• (9/1939), thá»±c dÃ¢n PhÃ¡p Ä‘Ã n Ã¡p cÃ¡ch máº¡ng, Äáº£ng rÃºt vÃ o hoáº¡t Ä‘á»™ng bÃ­ máº­t. Cuá»™c váº­n Ä‘á»™ng dÃ¢n chá»§ káº¿t thÃºc.'},
  {id:55,era:'4/1938 Â· Lá»±c lÆ°á»£ng Äáº£ng',content:'4/1938, Äáº£ng cÃ³ 1.597 Ä‘áº£ng viÃªn hoáº¡t Ä‘á»™ng bÃ­ máº­t vÃ  hÆ¡n 200 Ä‘áº£ng viÃªn cÃ´ng khai. Sá»‘ há»™i viÃªn cÃ¡c tá»• chá»©c quáº§n chÃºng: 35.009 ngÆ°á»i.'},
  {id:56,era:'1936â€“1939 Â· Ã nghÄ©a Lá»‹ch sá»­',content:'Cuá»™c váº­n Ä‘á»™ng dÃ¢n chá»§ 1936â€“1939 lÃ m cho tráº­n Ä‘á»‹a vÃ  lá»±c lÆ°á»£ng cÃ¡ch máº¡ng Ä‘Æ°á»£c má»Ÿ rá»™ng, lÃ  bÆ°á»›c chuáº©n bá»‹ cho tháº¯ng lá»£i cá»§a CÃ¡ch máº¡ng ThÃ¡ng TÃ¡m sau nÃ y.'},
];

// ============================================================
// CANVAS / WORLD
// ============================================================
const ctx = canvas.getContext('2d');
const GROUND_Y=CH-56,WORLD_W=7200;
const GRAVITY=0.55,JUMP_VY=-13.5,SPEED=4.2,GOAL_X=WORLD_W-320;

let completed=new Set();
try{const s=localStorage.getItem('spst_done');if(s)completed=new Set(JSON.parse(s));}catch(e){}
let paused=false,activeBoxId=null,goalUnlocked=completed.size>=56,chatHistory=[];
let activePeriod='all',chatCloseCooldown=0;
let score=0;
try{const s=localStorage.getItem('spst_score');if(s)score=parseInt(s)||0;}catch(e){}

const fireworks=[];
const GROUND={x:0,y:GROUND_Y,w:WORLD_W,h:56};
const platDefs=[
  [160,360,110],[320,310,90],[490,265,110],[660,305,90],[830,350,110],
  [1000,295,90],[1170,330,110],[1340,270,90],[1520,310,110],[1700,355,90],
  [1870,290,110],[2050,325,90],[2230,268,110],[2410,308,90],[2590,350,110],
  [2770,285,90],[2950,320,110],[3130,265,90],[3310,305,110],[3490,350,90],
  [3670,285,110],[3850,325,90],[4030,268,110],[4210,308,90],[4390,350,110],
  [4570,285,90],[4750,320,110],[4930,265,90],[5110,305,110],[5290,350,90],
  [5470,285,110],[5650,320,90],[5830,268,110],[6010,308,90],[6200,350,110],
];
const PLATFORMS=platDefs.map(([x,y,w])=>({x,y,w,h:16}));

const MBOXES=BOXES_DATA.map((bd,i)=>{
  const startX=180,spacingX=120;
  const bx=startX+i*spacingX;
  const by=i%2===0?250:310;
  return{id:bd.id,x:bx,y:by,w:36,h:36,done:completed.has(bd.id),bounceOff:0,bOffY:0};
});
for(const b of MBOXES)if(completed.has(b.id))b.done=true;

const P={x:60,y:GROUND_Y-44,w:32,h:44,vx:0,vy:0,onGround:false,right:true,af:0,at:0};
let camX=0;
const keys={};

window.addEventListener('keydown',e=>{
  keys[e.code]=true;
  if(['Space','ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(e.code))e.preventDefault();
  if(e.code==='Enter'&&document.getElementById('modal').classList.contains('show'))closeBox();
  if(document.getElementById('chatOverlay').classList.contains('show')){
    if(['ArrowLeft','ArrowRight','KeyA','KeyD'].includes(e.code))closeChat();
  }
});
window.addEventListener('keyup',e=>{keys[e.code]=false;});

function addScore(pts,wx,wy){
  score+=pts;
  try{localStorage.setItem('spst_score',score);}catch(e){}
  document.getElementById('scoreDisplay').textContent=score;
  const pop=document.createElement('div');
  pop.className='score-popup';
  pop.textContent='+'+pts;
  const rect=canvas.getBoundingClientRect();
  const scaleX=rect.width/CW, scaleY=rect.height/CH;
  const sx=rect.left+(wx-camX)*scaleX;
  const sy=rect.top+wy*scaleY;
  pop.style.left=sx+'px'; pop.style.top=sy+'px';
  document.body.appendChild(pop);
  setTimeout(()=>pop.remove(),1200);
}
document.getElementById('scoreDisplay').textContent=score;

function spawnFireworks(){
  for(let i=0;i<12;i++){
    fireworks.push({
      x:Math.random()*CW, y:Math.random()*(CH*0.6)+20,
      particles:Array.from({length:22},()=>({
        vx:(Math.random()-0.5)*7, vy:(Math.random()-0.5)*7,
        life:1, color:`hsl(${Math.random()*60+10},100%,60%)`
      })),
      life:1
    });
  }
}
function updateFireworks(){
  for(let i=fireworks.length-1;i>=0;i--){
    const fw=fireworks[i];
    fw.life-=0.012;
    for(const p of fw.particles){p.vx*=0.96;p.vy=p.vy*0.96+0.05;p.life-=0.015;}
    if(fw.life<=0||fw.particles.every(p=>p.life<=0))fireworks.splice(i,1);
  }
}
function drawFireworks(){
  for(const fw of fireworks){
    for(const p of fw.particles){
      if(p.life<=0)continue;
      ctx.save();
      ctx.globalAlpha=p.life*fw.life;
      ctx.fillStyle=p.color;
      const ox=fw.x+p.vx*(1-p.life)*30, oy=fw.y+p.vy*(1-p.life)*30;
      ctx.beginPath();ctx.arc(ox,oy,2.5,0,Math.PI*2);ctx.fill();
      ctx.restore();
    }
  }
}

const bgStars=[];
for(let i=0;i<70;i++)bgStars.push({x:Math.random()*CW,y:Math.random()*(CH*.6),r:Math.random()*1.5+.3,t:Math.random()*Math.PI*2});
let bgTick=0;

function drawBackground(){
  bgTick++;
  const g=ctx.createLinearGradient(0,0,0,CH*.75);
  g.addColorStop(0,'#0f0000');g.addColorStop(.4,'#4a0000');g.addColorStop(1,'#780000');
  ctx.fillStyle=g;ctx.fillRect(0,0,CW,CH);
  for(const s of bgStars){
    const f=.55+.45*Math.sin(s.t+bgTick*.025);
    ctx.fillStyle=`rgba(255,220,160,${f*.85})`;
    ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,Math.PI*2);ctx.fill();
  }
  ctx.save();ctx.globalAlpha=.035;ctx.fillStyle='#FFD700';
  ctx.font='bold 200px serif';ctx.textAlign='center';
  for(let i=0;i<3;i++){const hx=((i*700-camX*.04)%(CW+600)+CW+600)%(CW+600)-100;ctx.fillText('â˜­',hx,CH*.58);}
  ctx.globalAlpha=1;ctx.textAlign='left';ctx.restore();
  for(let i=0;i<7;i++){const fx=((i*280-camX*.07)%(CW+300)+CW+300)%(CW+300)-80;drawFlag(fx,30+i%3*8,bgTick);}
  ctx.fillStyle='rgba(70,0,0,.5)';
  for(let i=0;i<9;i++){const mx=((i*210-camX*.11)%(CW+300)+CW+300)%(CW+300)-80;ctx.beginPath();ctx.moveTo(mx,CH);ctx.lineTo(mx+105,CH-155);ctx.lineTo(mx+210,CH);ctx.fill();}
  ctx.fillStyle='rgba(35,0,0,.65)';
  for(let i=0;i<7;i++){const mx=((i*260+90-camX*.17)%(CW+300)+CW+300)%(CW+300)-80;ctx.beginPath();ctx.moveTo(mx,CH);ctx.lineTo(mx+130,CH-105);ctx.lineTo(mx+260,CH);ctx.fill();}
}
function drawFlag(fx,fy,t){
  const FW=40,FH=28;
  ctx.fillStyle='#aa6600';ctx.fillRect(fx,fy,2,FH+20);
  ctx.save();ctx.beginPath();ctx.moveTo(fx+2,fy);
  for(let px=0;px<=FW;px++){const wave=Math.sin(px/FW*Math.PI*1.5+t*.065)*4;ctx.lineTo(fx+2+px,fy+wave);}
  for(let px=FW;px>=0;px--){const wave=Math.sin(px/FW*Math.PI*1.5+t*.065)*4;ctx.lineTo(fx+2+px,fy+FH+wave);}
  ctx.closePath();ctx.fillStyle='#cc0000';ctx.fill();
  drawStar(fx+2+FW*.28,fy+FH*.5,6,3,5);
  ctx.restore();
}
function drawStar(cx,cy,outerR,innerR,points){
  ctx.save();ctx.fillStyle='#FFD700';ctx.beginPath();
  for(let i=0;i<points*2;i++){
    const r=i%2===0?outerR:innerR,angle=(i*Math.PI/points)-Math.PI/2;
    i===0?ctx.moveTo(cx+r*Math.cos(angle),cy+r*Math.sin(angle)):ctx.lineTo(cx+r*Math.cos(angle),cy+r*Math.sin(angle));
  }
  ctx.closePath();ctx.fill();ctx.restore();
}
function drawGround(){
  ctx.fillStyle='#200e00';ctx.fillRect(-camX%1,GROUND_Y,WORLD_W,GROUND.h);
  ctx.fillStyle='#6b0000';ctx.fillRect(0,GROUND_Y,CW,8);
  ctx.strokeStyle='#330e00';ctx.lineWidth=1;
  for(let gx=(-camX%48+48)%48-48;gx<CW+48;gx+=48)
    for(let gy=GROUND_Y+8;gy<GROUND_Y+GROUND.h;gy+=14){const o=(Math.floor(gy/14)%2)*24;ctx.strokeRect(gx+o,gy,47,13);}
  ctx.fillStyle='#8b0000';
  for(let gx=(-camX%12+12)%12-12;gx<CW+12;gx+=6)ctx.fillRect(gx,GROUND_Y-1,2,7+(gx%3)*2);
}
function drawPlatform(pl){
  const sx=pl.x-camX;if(sx>CW+20||sx+pl.w<-20)return;
  ctx.fillStyle='rgba(0,0,0,.35)';ctx.fillRect(sx+3,pl.y+3,pl.w,pl.h);
  ctx.fillStyle='#5a1500';ctx.fillRect(sx,pl.y,pl.w,pl.h);
  ctx.fillStyle='#7a2500';ctx.fillRect(sx,pl.y,pl.w,5);
  ctx.fillStyle='rgba(0,0,0,.2)';
  for(let bx=sx;bx<sx+pl.w;bx+=16)ctx.fillRect(bx,pl.y,1,pl.h);
  ctx.fillStyle='#FFD70033';ctx.fillRect(sx,pl.y,pl.w,1);
}
function drawMBox(b){
  const sx=b.x-camX;if(sx>CW+60||sx<-60)return;
  const sy=b.y+b.bOffY;
  if(b.done){
    ctx.fillStyle='rgba(0,0,0,.3)';ctx.fillRect(sx+2,sy+2,b.w,b.h);
    ctx.fillStyle='#251200';ctx.fillRect(sx,sy,b.w,b.h);
    ctx.fillStyle='#3a2000';ctx.fillRect(sx+3,sy+3,b.w-6,b.h-6);
    ctx.fillStyle='#5a4030';ctx.font='10px serif';ctx.textAlign='center';ctx.fillText('âœ“',sx+b.w/2,sy+b.h/2+4);ctx.textAlign='left';
  }else{
    ctx.fillStyle='rgba(0,0,0,.3)';ctx.fillRect(sx+3,sy+3,b.w,b.h);
    ctx.fillStyle='#996600';ctx.fillRect(sx,sy,b.w,b.h);
    ctx.fillStyle='#FFD700';ctx.fillRect(sx+2,sy+2,b.w-4,b.h-4);
    ctx.fillStyle='#ffe566';ctx.fillRect(sx+4,sy+4,b.w-8,b.h-8);
    ctx.fillStyle='#fff8cc';ctx.fillRect(sx+5,sy+5,b.w-16,4);ctx.fillRect(sx+5,sy+5,4,b.h-14);
    ctx.fillStyle='#aa8800';ctx.fillRect(sx+2,sy+b.h-5,b.w-4,3);
    ctx.fillStyle='#7a0000';ctx.font='bold 20px serif';ctx.textAlign='center';ctx.fillText('?',sx+b.w/2,sy+b.h-7);ctx.textAlign='left';
    ctx.fillStyle='#5a0000';ctx.font='bold 7px monospace';ctx.fillText(b.id,sx+2,sy+9);
  }
}
function drawPlayer(){
  const sx=P.x-camX,sy=P.y;
  ctx.save();
  if(!P.right){ctx.translate(sx+P.w,0);ctx.scale(-1,1);}else ctx.translate(sx,0);
  const run=P.vx!==0&&P.onGround,jump=!P.onGround,f=P.af;
  ctx.fillStyle='rgba(0,0,0,.2)';ctx.beginPath();ctx.ellipse(P.w/2,sy+P.h+3,13,4,0,0,Math.PI*2);ctx.fill();
  ctx.fillStyle='#7a0000';ctx.fillRect(5,sy+1,22,5);
  ctx.fillStyle='#B22222';ctx.fillRect(7,sy-2,16,7);
  ctx.fillStyle='#FFD700';ctx.fillRect(8,sy-1,6,3);ctx.fillStyle='#B22222';ctx.fillRect(9,sy,4,2);
  ctx.fillStyle='#FDBCB4';ctx.fillRect(7,sy+5,18,13);
  ctx.fillStyle='#222';ctx.fillRect(10,sy+9,3,3);ctx.fillRect(18,sy+9,3,3);
  ctx.fillStyle='#333';ctx.fillRect(10,sy+7,4,2);ctx.fillRect(18,sy+7,4,2);
  ctx.fillStyle='#2a1800';ctx.fillRect(9,sy+14,14,3);
  ctx.fillStyle='rgba(255,140,140,.3)';ctx.beginPath();ctx.arc(10,sy+14,4,0,Math.PI*2);ctx.fill();ctx.beginPath();ctx.arc(22,sy+14,4,0,Math.PI*2);ctx.fill();
  ctx.fillStyle='#B22222';ctx.fillRect(4,sy+18,24,19);
  ctx.fillStyle='#8a1111';
  ctx.beginPath();ctx.moveTo(4,sy+18);ctx.lineTo(10,sy+24);ctx.lineTo(4,sy+37);ctx.fill();
  ctx.beginPath();ctx.moveTo(28,sy+18);ctx.lineTo(22,sy+24);ctx.lineTo(28,sy+37);ctx.fill();
  ctx.fillStyle='#f0e0c0';ctx.fillRect(10,sy+18,12,16);
  ctx.fillStyle='#FFD700';ctx.font='bold 14px serif';ctx.textAlign='center';ctx.fillText('â˜…',P.w/2,sy+31);ctx.textAlign='left';
  ctx.fillStyle='#B22222';
  if(jump){ctx.fillRect(-2,sy+18,7,10);ctx.fillRect(27,sy+18,7,10);}
  else if(run&&f%2===0){ctx.fillRect(-1,sy+22,6,9);ctx.fillRect(27,sy+19,6,9);}
  else{ctx.fillRect(0,sy+20,5,9);ctx.fillRect(27,sy+20,5,9);}
  ctx.fillStyle='#FDBCB4';ctx.fillRect(-2,sy+(jump?27:29),5,5);ctx.fillRect(29,sy+(jump?27:29),5,5);
  ctx.fillStyle='#1a1a3a';
  if(jump){ctx.fillRect(5,sy+37,11,8);ctx.fillRect(16,sy+37,11,8);}
  else if(run){if(f%2===0){ctx.fillRect(5,sy+37,11,10);ctx.fillRect(16,sy+35,11,12);}else{ctx.fillRect(5,sy+35,11,12);ctx.fillRect(16,sy+37,11,10);}}
  else{ctx.fillRect(5,sy+37,11,10);ctx.fillRect(16,sy+37,11,10);}
  ctx.fillStyle='#FFD700';ctx.fillRect(4,sy+36,24,3);ctx.fillStyle='#cc9900';ctx.fillRect(14,sy+36,4,3);
  ctx.fillStyle='#111';ctx.fillRect(3,sy+46,14,6);ctx.fillRect(15,sy+46,14,6);
  ctx.fillStyle='#333';ctx.fillRect(4,sy+47,4,2);ctx.fillRect(16,sy+47,4,2);
  ctx.restore();
}
function drawGoal(){
  const sx=GOAL_X-camX;
  if(sx>CW+200||sx<-250)return;
  const gy=GROUND_Y;
  ctx.fillStyle='#3a1200';ctx.fillRect(sx,gy-170,150,170);
  ctx.fillStyle='#4a2000';
  for(let bi=0;bi<5;bi++)if(bi%2===0)ctx.fillRect(sx+bi*32,gy-192,26,26);
  ctx.fillStyle='#FFD70033';ctx.fillRect(sx+18,gy-145,30,22);ctx.fillRect(sx+100,gy-145,30,22);
  ctx.strokeStyle='#FFD70066';ctx.lineWidth=1;ctx.strokeRect(sx+18,gy-145,30,22);ctx.strokeRect(sx+100,gy-145,30,22);
  ctx.fillStyle='#100800';ctx.fillRect(sx+52,gy-75,46,75);
  ctx.beginPath();ctx.arc(sx+75,gy-75,23,Math.PI,0);ctx.fill();
  ctx.strokeStyle='#6b3300';ctx.lineWidth=2;ctx.beginPath();ctx.arc(sx+75,gy-75,23,Math.PI,0);ctx.stroke();
  if(goalUnlocked){
    const aura=ctx.createRadialGradient(sx+75,gy-85,10,sx+75,gy-85,80);
    aura.addColorStop(0,'rgba(255,215,0,.15)');aura.addColorStop(1,'rgba(255,215,0,0)');
    ctx.fillStyle=aura;ctx.fillRect(sx-10,gy-200,180,200);
    ctx.fillStyle='#6a0000';ctx.fillRect(sx+73,gy-240,3,60);
    ctx.fillStyle='#B22222';ctx.fillRect(sx+76,gy-240,36,24);
    ctx.fillStyle='#FFD700';ctx.font='14px serif';ctx.fillText('â˜…',sx+82,gy-222);
    ctx.shadowBlur=15;ctx.shadowColor='#FFD700';ctx.fillStyle='#FFD700';
    ctx.font='bold 8px monospace';ctx.textAlign='center';
    ctx.fillText('ğŸ“œ AI HISTORY',sx+75,gy-88);ctx.fillText('â–¼ VÃ€O ÄÃ‚Y â–¼',sx+75,gy-72);
    ctx.shadowBlur=0;
    ctx.fillStyle='rgba(255,215,0,.18)';ctx.fillRect(sx+158,gy-58,90,32);
    ctx.strokeStyle='#FFD700';ctx.lineWidth=1.5;ctx.strokeRect(sx+158,gy-58,90,32);
    ctx.fillStyle='#FFD700';ctx.font='bold 7px monospace';
    ctx.fillText('â†º CHÆ I Láº I',sx+203,gy-37);
    ctx.textAlign='left';
  }else{
    ctx.fillStyle='#555';ctx.font='28px serif';ctx.textAlign='center';ctx.fillText('ğŸ”’',sx+75,gy-90);
    ctx.fillStyle='#888';ctx.font='7px monospace';ctx.fillText('Äá»ŒC Háº¾T 56 BOX',sx+75,gy-68);ctx.textAlign='left';
  }
}
function drawMinimap(){
  const mw=130,mh=16,mx=CW-mw-8,my=CH-mh-6;
  ctx.fillStyle='rgba(0,0,0,.6)';ctx.fillRect(mx,my,mw,mh);
  ctx.strokeStyle='#FFD70055';ctx.lineWidth=1;ctx.strokeRect(mx,my,mw,mh);
  for(const b of MBOXES)if(b.done){const bx2=mx+(b.x/WORLD_W)*mw;ctx.fillStyle='#FFD70066';ctx.fillRect(bx2,my+2,2,mh-4);}
  const px2=mx+(P.x/WORLD_W)*mw;ctx.fillStyle='#FFD700';ctx.fillRect(px2-2,my,4,mh);
  const gx2=mx+(GOAL_X/WORLD_W)*mw;ctx.fillStyle=goalUnlocked?'#ff4444':'#666';ctx.fillRect(gx2,my,3,mh);
  ctx.fillStyle='#FFD70099';ctx.font='6px monospace';ctx.fillText('MAP',mx+2,my+mh-3);
}

function update(){
  if(paused)return;
  P.vx=0;
  if(keys['ArrowLeft']||keys['KeyA']){P.vx=-SPEED;P.right=false;}
  if(keys['ArrowRight']||keys['KeyD']){P.vx=SPEED;P.right=true;}
  if((keys['Space']||keys['ArrowUp']||keys['KeyW'])&&P.onGround){P.vy=JUMP_VY;P.onGround=false;}
  P.vy=Math.min(P.vy+GRAVITY,15);
  P.x=Math.max(0,Math.min(WORLD_W-P.w,P.x+P.vx));
  P.y+=P.vy;P.onGround=false;
  if(P.y+P.h>=GROUND_Y&&P.vy>=0){P.y=GROUND_Y-P.h;P.vy=0;P.onGround=true;}
  for(const pl of PLATFORMS){
    if(P.x+P.w<=pl.x||P.x>=pl.x+pl.w)continue;
    const pb=P.y+P.h-P.vy;
    if(P.vy>=0&&pb<=pl.y+2&&P.y+P.h>=pl.y){P.y=pl.y-P.h;P.vy=0;P.onGround=true;}
  }
  for(const b of MBOXES){
    if(b.done)continue;
    if(P.x+P.w<=b.x+2||P.x>=b.x+b.w-2)continue;
    const pt=P.y-P.vy;
    if(P.vy<0&&pt>=b.y+b.h-2&&P.y<=b.y+b.h){P.vy=2;triggerBox(b);}
  }
  if(P.y>CH+100){P.y=GROUND_Y-P.h;P.vy=0;P.onGround=true;}
  if(++P.at>=7){P.at=0;P.af=(P.af+1)%4;}
  camX=Math.max(0,Math.min(WORLD_W-CW,P.x+P.w/2-CW*.38));
  for(const b of MBOXES){
    if(b.bounceOff>0){b.bounceOff--;b.bOffY=-Math.sin((1-b.bounceOff/20)*Math.PI)*14;}else b.bOffY=0;
  }
  if(chatCloseCooldown>0)chatCloseCooldown--;
  if(goalUnlocked&&chatCloseCooldown===0&&P.x+P.w>GOAL_X+44&&P.x<GOAL_X+106&&P.y+P.h>GROUND_Y-75)openChatArea();
  updateFireworks();
}

function triggerBox(b){
  b.done=true;b.bounceOff=20;activeBoxId=b.id;paused=true;
  addScore(10,b.x+b.w/2,b.y);
  const data=BOXES_DATA.find(d=>d.id===b.id);
  document.getElementById('modalTitle').textContent=`BOX ${b.id}`;
  document.getElementById('modalEra').textContent=data.era||'';
  document.getElementById('modalBadge').textContent=`${completed.size+1} / 56`;
  document.getElementById('modalBody').textContent=data.content;
  document.getElementById('modal').classList.add('show');
}
function closeBox(){
  if(!document.getElementById('modal').classList.contains('show'))return;
  if(activeBoxId!==null){
    completed.add(activeBoxId);
    try{localStorage.setItem('spst_done',JSON.stringify([...completed]));}catch(e){}
    activeBoxId=null;updateHUD();
  }
  document.getElementById('modal').classList.remove('show');
  paused=false;
  if(completed.size>=56&&!goalUnlocked){
    goalUnlocked=true;
    spawnFireworks();spawnFireworks();
    setTimeout(()=>{spawnFireworks();},600);
    setTimeout(()=>{
      paused=true;
      document.getElementById('victoryScore').textContent=score;
      document.getElementById('victoryOverlay').classList.add('show');
    },1800);
  }
}
document.getElementById('btnContinue').onclick=closeBox;

function updateHUD(){
  const n=completed.size;
  document.getElementById('progressFill').style.width=(n/56*100)+'%';
  document.getElementById('progressTxt').textContent=`${n} / 56`;
}
updateHUD();

canvas.addEventListener('click',e=>{
  if(!goalUnlocked)return;
  const rect=canvas.getBoundingClientRect();
  const scaleX=CW/rect.width, scaleY=CH/rect.height;
  const mx=(e.clientX-rect.left)*scaleX;
  const my=(e.clientY-rect.top)*scaleY;
  const bx=GOAL_X-camX+158, by=GROUND_Y-58;
  if(mx>=bx&&mx<=bx+90&&my>=by&&my<=by+32)doRestart();
});

function doRestart(){
  completed=new Set();score=0;
  try{localStorage.removeItem('spst_done');localStorage.removeItem('spst_score');}catch(e){}
  for(const b of MBOXES)b.done=false;
  goalUnlocked=false;paused=false;chatCloseCooldown=0;
  P.x=60;P.y=GROUND_Y-44;P.vx=0;P.vy=0;camX=0;
  updateHUD();
  document.getElementById('scoreDisplay').textContent=0;
  document.getElementById('victoryOverlay').classList.remove('show');
  document.getElementById('chatOverlay').classList.remove('show');
  document.getElementById('quizOverlay').classList.remove('show');
  document.getElementById('timelineOverlay').classList.remove('show');
}
document.getElementById('btnRestart').onclick=doRestart;

let lastT=0;
function loop(ts){
  const dt=Math.min((ts-lastT)/16.67,3);lastT=ts;
  update();
  ctx.clearRect(0,0,CW,CH);
  drawBackground();drawGround();
  for(const pl of PLATFORMS)drawPlatform(pl);
  for(const b of MBOXES)drawMBox(b);
  drawGoal();drawPlayer();
  drawFireworks();
  drawMinimap();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

// TIMELINE
function buildTimeline(){
  const el=document.getElementById('timelineBody');
  el.innerHTML='';
  for(const p of TIMELINE_PERIODS){
    const sec=document.createElement('div');sec.className='tl-period';
    sec.innerHTML=`<div class="tl-period-title">${p.title}</div>`;
    for(const item of p.items){
      sec.innerHTML+=`<div class="tl-item"><div class="tl-dot"></div><div class="tl-text"><span class="tl-date">${item.date}</span> â€” ${item.text}</div></div>`;
    }
    el.appendChild(sec);
  }
}
document.getElementById('btnShowTimeline').onclick=()=>{
  buildTimeline();
  document.getElementById('victoryOverlay').classList.remove('show');
  document.getElementById('timelineOverlay').classList.add('show');
};
document.getElementById('btnCloseTimeline').onclick=()=>{
  document.getElementById('timelineOverlay').classList.remove('show');
  document.getElementById('victoryOverlay').classList.add('show');
};
document.getElementById('btnTimelineToQuiz').onclick=()=>{
  document.getElementById('timelineOverlay').classList.remove('show');
  startQuiz();
};
document.getElementById('btnTimelineToChat').onclick=()=>{
  document.getElementById('timelineOverlay').classList.remove('show');
  openChatArea();
};

// QUIZ
let quizQuestions=[],quizIdx=0,quizScore=0,quizAnswered=false;
function startQuiz(){
  const shuffled=[...ALL_QUESTIONS].sort(()=>Math.random()-.5);
  quizQuestions=shuffled.slice(0,10);
  quizIdx=0;quizScore=0;quizAnswered=false;
  document.getElementById('quizOverlay').classList.add('show');
  document.getElementById('victoryOverlay').classList.remove('show');
  renderQuizQuestion();
}
document.getElementById('btnStartQuiz').onclick=()=>{
  document.getElementById('victoryOverlay').classList.remove('show');
  startQuiz();
};
function renderQuizQuestion(){
  if(quizIdx>=quizQuestions.length){renderQuizResult();return;}
  const q=quizQuestions[quizIdx];
  document.getElementById('quizProgress').textContent=`CÃ¢u ${quizIdx+1} / ${quizQuestions.length}`;
  quizAnswered=false;
  document.getElementById('quizContent').innerHTML=`
    <div class="quiz-body">
      <div class="quiz-q">${q.q}</div>
      <div class="quiz-opts">
        ${q.opts.map((o,i)=>`<button class="quiz-opt" data-i="${i}">${String.fromCharCode(65+i)}. ${o}</button>`).join('')}
      </div>
      <div class="quiz-explanation" id="quizExp">${q.exp}</div>
    </div>
    <div class="quiz-footer">
      <div class="quiz-score-txt">âœ“ ${quizScore} / ${quizIdx} Ä‘iá»ƒm</div>
      <button class="btn-quiz-next" id="btnQuizNext" style="display:none">${quizIdx+1<quizQuestions.length?'CÃ¢u tiáº¿p â†’':'Xem káº¿t quáº£ â†’'}</button>
    </div>`;
  document.querySelectorAll('.quiz-opt').forEach(btn=>{
    btn.addEventListener('click',()=>{
      if(quizAnswered)return;
      quizAnswered=true;
      const chosen=parseInt(btn.dataset.i);
      const correct=quizQuestions[quizIdx].ans;
      document.querySelectorAll('.quiz-opt').forEach((b,i)=>{
        b.disabled=true;
        if(i===correct)b.classList.add('correct');
        if(i===chosen&&chosen!==correct)b.classList.add('wrong');
      });
      if(chosen===correct){quizScore++;addScore(20,CW/2,CH/2);}
      document.getElementById('quizExp').classList.add('show');
      document.getElementById('btnQuizNext').style.display='';
      document.querySelector('.quiz-score-txt').textContent=`âœ“ ${quizScore} / ${quizIdx+1} Ä‘iá»ƒm`;
    });
  });
  document.getElementById('btnQuizNext').onclick=()=>{quizIdx++;renderQuizQuestion();};
}
function renderQuizResult(){
  const pct=Math.round(quizScore/quizQuestions.length*100);
  const medal=pct>=90?'ğŸ¥‡':pct>=70?'ğŸ¥ˆ':pct>=50?'ğŸ¥‰':'ğŸ“š';
  const msg=pct>=90?'Xuáº¥t sáº¯c! Báº¡n náº¯m vá»¯ng lá»‹ch sá»­ Äáº£ng CSVN!':pct>=70?'Tá»‘t láº¯m! Kiáº¿n thá»©c khÃ¡ vá»¯ng.':pct>=50?'KhÃ¡! HÃ£y Ã´n láº¡i má»™t sá»‘ má»‘c quan trá»ng.':'Cáº§n Ã´n táº­p thÃªm! HÃ£y Ä‘á»c láº¡i cÃ¡c box.';
  addScore(pct>=70?50:0,CW/2,CH/2);
  document.getElementById('quizContent').innerHTML=`
    <div class="quiz-result">
      <div class="quiz-medals">${medal}</div>
      <div class="quiz-result-score">${quizScore} / ${quizQuestions.length}</div>
      <div class="quiz-result-msg">${msg}<br><small style="color:#FFD70088">Tá»•ng Ä‘iá»ƒm hiá»‡n táº¡i: ${score}</small></div>
      <div class="quiz-result-buttons">
        <button class="btn-v secondary" onclick="startQuiz()">ğŸ”„ LÃ m láº¡i</button>
        <button class="btn-v primary" onclick="document.getElementById('quizOverlay').classList.remove('show');openChatArea()">ğŸ¤– VÃ o AI Chat</button>
        <button class="btn-v secondary" onclick="document.getElementById('quizOverlay').classList.remove('show');document.getElementById('victoryOverlay').classList.add('show')">â† Quay láº¡i</button>
      </div>
    </div>`;
  if(pct>=70){spawnFireworks();setTimeout(spawnFireworks,500);}
}

document.getElementById('btnOpenChat').onclick=()=>{document.getElementById('victoryOverlay').classList.remove('show');openChatArea();};

// ============================================================
// CHAT â€” gá»i qua /api/chat proxy, KHÃ”NG dÃ¹ng API key trá»±c tiáº¿p
// ============================================================
function openChatArea(){
  if(document.getElementById('chatOverlay').classList.contains('show'))return;
  paused=true;
  buildChatUI();
  document.getElementById('chatOverlay').classList.add('show');
}
function closeChat(){
  document.getElementById('chatOverlay').classList.remove('show');
  paused=false;
  chatCloseCooldown=180;
}
document.getElementById('chatCloseBtn').onclick=closeChat;

function buildChatUI(){
  const tabsEl=document.getElementById('chatTabs');tabsEl.innerHTML='';
  for(const p of PERIODS){
    const btn=document.createElement('button');btn.className='chat-tab'+(p.id===activePeriod?' active':'');
    btn.textContent=p.label;btn.onclick=()=>switchPeriod(p.id);tabsEl.appendChild(btn);
  }
  if(document.getElementById('chatMessages').children.length===0)loadPeriodWelcome(activePeriod);
  buildQuickPrompts(activePeriod);
}
function switchPeriod(pid){
  activePeriod=pid;chatHistory=[];
  document.querySelectorAll('.chat-tab').forEach(t=>{t.classList.toggle('active',t.textContent===PERIODS.find(p=>p.id===pid).label);});
  document.getElementById('chatMessages').innerHTML='';
  loadPeriodWelcome(pid);buildQuickPrompts(pid);
}
function loadPeriodWelcome(pid){
  const p=PERIODS.find(x=>x.id===pid);
  const el=document.createElement('div');el.className='msg bot';
  el.innerHTML=`<div class="msg-era-tag">${p.label}</div><br>${renderMD(p.welcome)}`;
  document.getElementById('chatMessages').appendChild(el);
}
function buildQuickPrompts(pid){
  const p=PERIODS.find(x=>x.id===pid);
  const el=document.getElementById('quickPrompts');el.innerHTML='';
  for(const qp of p.quickPrompts){
    const btn=document.createElement('button');btn.className='qp-btn';btn.textContent=qp;
    btn.onclick=()=>{document.getElementById('chatInput').value=qp;sendChat();};
    el.appendChild(btn);
  }
}
function renderMD(t){
  return t
    .replace(/^---$/gm,'<hr>').replace(/^### (.+)$/gm,'<h3>$1</h3>').replace(/^## (.+)$/gm,'<h2>$1</h2>').replace(/^# (.+)$/gm,'<h1>$1</h1>')
    .replace(/^> (.+)$/gm,'<blockquote>$1</blockquote>').replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>').replace(/\*(.+?)\*/g,'<em>$1</em>')
    .replace(/`(.+?)`/g,'<code>$1</code>').replace(/^[-â€¢] (.+)$/gm,'<li>$1</li>').replace(/^(\d+)\. (.+)$/gm,'<li><strong>$1.</strong> $2</li>')
    .replace(/(<li>[\s\S]+?)(?=\n[^<]|\n*$)/g,m=>`<ul>${m}</ul>`).replace(/\n\n/g,'<br><br>').replace(/\n/g,'<br>');
}
function timeStr(){const d=new Date();return`${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}`;}

async function sendChat(){
  const msg=document.getElementById('chatInput').value.trim();
  if(!msg||document.getElementById('sendBtn').disabled)return;
  document.getElementById('chatInput').value='';
  document.getElementById('sendBtn').disabled=true;

  const period=PERIODS.find(p=>p.id===activePeriod);

  const uEl=document.createElement('div');uEl.className='msg user';
  uEl.innerHTML=msg.replace(/</g,'&lt;')+`<div class="msg-time">${timeStr()}</div>`;
  document.getElementById('chatMessages').appendChild(uEl);
  chatHistory.push({role:'user',content:msg});

  const botEl=document.createElement('div');botEl.className='msg bot';
  botEl.innerHTML='<div class="typing-dots"><span></span><span></span><span></span></div>';
  document.getElementById('chatMessages').appendChild(botEl);
  document.getElementById('chatMessages').scrollTop=99999;

  try{
    const sysPrompt=`${SYSTEM_BASE}\nGiai Ä‘oáº¡n Ä‘ang tháº£o luáº­n: ${period.label}.\n${period.prompt}`;

    // âœ… Gá»i qua Vercel serverless proxy â€” API key an toÃ n trÃªn server
    const res=await fetch('/api/chat',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        model:GROQ_MODEL,
        messages:[{role:'system',content:sysPrompt},...chatHistory.slice(-14)],
        max_tokens:1400,
        temperature:0.6
      })
    });

    const data=await res.json();
    if(data.error)throw new Error(typeof data.error==='object'?data.error.message:data.error);

    const reply=data.choices[0].message.content;
    chatHistory.push({role:'assistant',content:reply});
    botEl.innerHTML=`<div class="msg-era-tag">${period.label}</div><br>${renderMD(reply)}<div class="msg-time">${timeStr()} Â· AI</div>`;
  }catch(err){
    botEl.innerHTML=`<span style="color:#ff7777">âŒ Lá»—i: <code>${err.message}</code></span>`;
  }

  document.getElementById('sendBtn').disabled=false;
  document.getElementById('chatMessages').scrollTop=99999;
}

document.getElementById('sendBtn').onclick=sendChat;
document.getElementById('chatInput').addEventListener('keydown',e=>{
  if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendChat();}
});

// Mobile
if('ontouchstart' in window){
  const bar=document.createElement('div');
  bar.style.cssText='position:fixed;bottom:0;left:0;right:0;display:flex;justify-content:space-between;align-items:flex-end;padding:8px 14px 12px;z-index:50;pointer-events:none';
  bar.innerHTML=`<div style="display:flex;gap:8px;pointer-events:all"><button id="tl" style="width:60px;height:60px;background:rgba(178,34,34,.88);border:2px solid #FFD700;color:#FFD700;font-size:24px;border-radius:10px;touch-action:none">â—€</button><button id="tr" style="width:60px;height:60px;background:rgba(178,34,34,.88);border:2px solid #FFD700;color:#FFD700;font-size:24px;border-radius:10px;touch-action:none">â–¶</button></div><button id="tj" style="width:76px;height:60px;background:rgba(255,215,0,.92);border:2px solid #B22222;color:#B22222;font-family:'Press Start 2P',monospace;font-size:8px;border-radius:10px;pointer-events:all;touch-action:none">JUMP</button>`;
  document.body.appendChild(bar);
  [['tl','ArrowLeft'],['tr','ArrowRight'],['tj','Space']].forEach(([id,c])=>{
    document.getElementById(id).addEventListener('touchstart',e=>{e.preventDefault();keys[c]=true;},{passive:false});
    document.getElementById(id).addEventListener('touchend',e=>{e.preventDefault();keys[c]=false;},{passive:false});
  });
}
</script>
</body>
</html>